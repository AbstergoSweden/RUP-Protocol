{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://rup-protocol.dev/schemas/v2.1.0/rup-schema.json",
  "title": "Repository Upgrade Protocol (RUP) Schema",
  "description": "JSON Schema for validating RUP v2.1.0 protocol definitions. Provides comprehensive validation for AI-driven repository maintenance and upgrade workflows.",
  "type": "object",
  "required": [
    "schema_version",
    "protocol_version",
    "metadata",
    "agent_architecture",
    "priorities",
    "guardrails",
    "evaluation",
    "phases"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of the schema",
      "examples": ["2.1.0"]
    },
    "protocol_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of the protocol",
      "examples": ["2.1.0"]
    },
    "last_updated": {
      "type": "string",
      "format": "date",
      "description": "ISO 8601 date of last update"
    },
    "license": {
      "type": "string",
      "description": "SPDX license identifier",
      "examples": ["CC0-1.0", "MIT", "Apache-2.0"]
    },
    "maintainer": {
      "type": "string",
      "description": "Protocol maintainer or organization"
    },
    "metadata": {
      "$ref": "#/$defs/Metadata"
    },
    "quick_start": {
      "$ref": "#/$defs/QuickStart"
    },
    "audience": {
      "$ref": "#/$defs/Audience"
    },
    "assumptions": {
      "$ref": "#/$defs/Assumptions"
    },
    "agent_architecture": {
      "$ref": "#/$defs/AgentArchitecture"
    },
    "tool_contracts": {
      "$ref": "#/$defs/ToolContracts"
    },
    "priorities": {
      "$ref": "#/$defs/Priorities"
    },
    "guardrails": {
      "$ref": "#/$defs/Guardrails"
    },
    "evaluation": {
      "$ref": "#/$defs/Evaluation"
    },
    "phases": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/Phase"
      },
      "description": "Ordered list of execution phases"
    },
    "commit_protocol": {
      "$ref": "#/$defs/CommitProtocol"
    },
    "change_management": {
      "$ref": "#/$defs/ChangeManagement"
    },
    "error_handling": {
      "$ref": "#/$defs/ErrorHandling"
    },
    "monorepo": {
      "$ref": "#/$defs/MonorepoSupport"
    },
    "scaling": {
      "$ref": "#/$defs/ScalingRules"
    },
    "verification_commands": {
      "$ref": "#/$defs/VerificationCommands"
    },
    "troubleshooting": {
      "$ref": "#/$defs/Troubleshooting"
    },
    "advanced_features": {
      "$ref": "#/$defs/AdvancedFeatures"
    },
    "notes": {
      "$ref": "#/$defs/Notes"
    }
  },
  "additionalProperties": false,
  "$defs": {
    "Metadata": {
      "type": "object",
      "required": ["name", "changelog"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Protocol name"
        },
        "designation": {
          "type": "string",
          "description": "Protocol designation or mode"
        },
        "tagline": {
          "type": "string",
          "maxLength": 200,
          "description": "Short description"
        },
        "changelog": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/ChangelogEntry"
          }
        },
        "evaluation_history": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/EvaluationHistoryEntry"
          }
        }
      },
      "additionalProperties": false
    },
    "ChangelogEntry": {
      "type": "object",
      "required": ["version", "date", "changes"],
      "properties": {
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "date": {
          "type": "string",
          "format": "date"
        },
        "changes": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "EvaluationHistoryEntry": {
      "type": "object",
      "required": ["version", "repos_tested", "success_rate"],
      "properties": {
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "repos_tested": {
          "type": "integer",
          "minimum": 0
        },
        "success_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "avg_time_minutes": {
          "type": "number",
          "minimum": 0
        },
        "common_failures": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "improvements": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "QuickStart": {
      "type": "object",
      "properties": {
        "overview": {
          "type": "string",
          "description": "High-level protocol overview"
        },
        "minimum_viable_run": {
          "type": "object",
          "properties": {
            "description": {
              "type": "string"
            },
            "steps": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "total_time": {
              "type": "string"
            }
          }
        },
        "decision_tree": {
          "type": "object",
          "properties": {
            "start": {
              "type": "string"
            },
            "branches": {
              "type": "object",
              "additionalProperties": {
                "$ref": "#/$defs/DecisionBranch"
              }
            }
          }
        },
        "common_scenarios": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/Scenario"
          }
        }
      },
      "additionalProperties": false
    },
    "DecisionBranch": {
      "type": "object",
      "required": ["action"],
      "properties": {
        "action": {
          "type": "string"
        },
        "next": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "Scenario": {
      "type": "object",
      "required": ["name", "steps"],
      "properties": {
        "name": {
          "type": "string"
        },
        "steps": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "time": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "Audience": {
      "type": "object",
      "properties": {
        "primary": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "secondary": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "Assumptions": {
      "type": "object",
      "properties": {
        "capabilities": {
          "type": "object",
          "properties": {
            "required": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "optional": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "constraints": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "environment": {
          "type": "object",
          "properties": {
            "minimum": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "recommended": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "AgentArchitecture": {
      "type": "object",
      "required": ["agents"],
      "properties": {
        "overview": {
          "type": "string"
        },
        "pipeline": {
          "type": "string",
          "description": "ASCII diagram of agent pipeline"
        },
        "agents": {
          "type": "object",
          "minProperties": 1,
          "additionalProperties": {
            "$ref": "#/$defs/AgentDefinition"
          }
        }
      },
      "additionalProperties": false
    },
    "AgentDefinition": {
      "type": "object",
      "required": ["id", "responsibility", "scope"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^agent_[a-z_]+$"
        },
        "responsibility": {
          "type": "string"
        },
        "scope": {
          "type": "string"
        },
        "input_schema": {
          "$ref": "#/$defs/JsonSchemaDefinition"
        },
        "output_schema": {
          "$ref": "#/$defs/JsonSchemaDefinition"
        },
        "tools": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "error_modes": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/ErrorMode"
          }
        }
      },
      "additionalProperties": false
    },
    "JsonSchemaDefinition": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["object", "array", "string", "number", "integer", "boolean", "null"]
        },
        "required": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "properties": {
          "type": "object",
          "additionalProperties": true
        },
        "items": {
          "type": "object"
        },
        "additionalProperties": {
          "type": "boolean"
        },
        "description": {
          "type": "string"
        },
        "default": {},
        "enum": {
          "type": "array"
        },
        "minimum": {
          "type": "number"
        },
        "maximum": {
          "type": "number"
        },
        "minLength": {
          "type": "integer"
        },
        "maxLength": {
          "type": "integer"
        },
        "pattern": {
          "type": "string"
        },
        "format": {
          "type": "string"
        },
        "oneOf": {
          "type": "array",
          "items": {
            "type": "object"
          }
        },
        "anyOf": {
          "type": "array",
          "items": {
            "type": "object"
          }
        },
        "allOf": {
          "type": "array",
          "items": {
            "type": "object"
          }
        },
        "nullable": {
          "type": "boolean"
        }
      },
      "additionalProperties": true
    },
    "ErrorMode": {
      "type": "object",
      "required": ["code", "action"],
      "properties": {
        "code": {
          "type": "string",
          "pattern": "^[A-Z][A-Z0-9_]+$"
        },
        "severity": {
          "type": "string",
          "enum": ["critical", "error", "warning", "info"]
        },
        "action": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "ToolContracts": {
      "type": "object",
      "properties": {
        "principles": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "common_error_response": {
          "$ref": "#/$defs/JsonSchemaDefinition"
        },
        "tools": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/ToolDefinition"
          }
        }
      },
      "additionalProperties": false
    },
    "ToolDefinition": {
      "type": "object",
      "required": ["name", "description"],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9_]+$"
        },
        "description": {
          "type": "string"
        },
        "deterministic": {
          "type": "boolean"
        },
        "idempotent": {
          "type": "boolean"
        },
        "requires_network": {
          "type": "boolean"
        },
        "requires_execution": {
          "type": "boolean"
        },
        "input_schema": {
          "$ref": "#/$defs/JsonSchemaDefinition"
        },
        "output_schema": {
          "$ref": "#/$defs/JsonSchemaDefinition"
        }
      },
      "additionalProperties": false
    },
    "Priorities": {
      "type": "object",
      "minProperties": 1,
      "additionalProperties": {
        "$ref": "#/$defs/PriorityLevel"
      }
    },
    "PriorityLevel": {
      "type": "object",
      "required": ["description"],
      "properties": {
        "description": {
          "type": "string"
        },
        "time_allocation": {
          "type": "string",
          "pattern": "^\\d+(-\\d+)?%$"
        },
        "must_complete": {
          "type": "boolean"
        },
        "acceptance_criteria": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "examples": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "Guardrails": {
      "type": "object",
      "properties": {
        "hard_rules": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "soft_rules": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "scope_control": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "question_policy": {
          "type": "object",
          "properties": {
            "principle": {
              "type": "string"
            },
            "strategy": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "Evaluation": {
      "type": "object",
      "properties": {
        "success_criteria": {
          "type": "object",
          "properties": {
            "mandatory": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "quality_gates": {
              "type": "object",
              "additionalProperties": {
                "$ref": "#/$defs/QualityGate"
              }
            }
          }
        },
        "metrics": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "$ref": "#/$defs/MetricDefinition"
            }
          }
        },
        "validation_protocol": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "additionalProperties": false
    },
    "QualityGate": {
      "type": "object",
      "additionalProperties": {
        "oneOf": [
          {
            "type": "number"
          },
          {
            "type": "boolean"
          },
          {
            "type": "string"
          }
        ]
      }
    },
    "MetricDefinition": {
      "type": "object",
      "required": ["metric", "target"],
      "properties": {
        "metric": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "target": {
          "type": "string"
        },
        "measurement": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "Phase": {
      "type": "object",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^phase_\\d+_[a-z_]+$"
        },
        "name": {
          "type": "string"
        },
        "agent": {
          "type": "string"
        },
        "timeout_minutes": {
          "type": "integer",
          "minimum": 1,
          "maximum": 1440
        },
        "steps": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/PhaseStep"
          }
        },
        "workstreams": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/Workstream"
          }
        },
        "output_template": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "PhaseStep": {
      "type": "object",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "actions": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "Workstream": {
      "type": "object",
      "required": ["id", "priority"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^ws_[a-z_]+$"
        },
        "priority": {
          "type": "string",
          "enum": ["P0", "P1", "P2", "P3"]
        },
        "description": {
          "type": "string"
        },
        "process": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "step": {
                "type": "string"
              },
              "details": {
                "type": "string"
              }
            }
          }
        },
        "guidelines": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "rules": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "templates": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "components": {
          "type": "object",
          "additionalProperties": true
        },
        "coverage_targets": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "naming_conventions": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "platforms": {
          "type": "object",
          "additionalProperties": true
        },
        "bug_report_template": {
          "type": "string"
        },
        "best_practices": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": true
    },
    "CommitProtocol": {
      "type": "object",
      "required": ["standard", "format", "types"],
      "properties": {
        "standard": {
          "type": "string"
        },
        "format": {
          "type": "string"
        },
        "types": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/CommitType"
          }
        },
        "breaking_changes": {
          "type": "object",
          "properties": {
            "indicator": {
              "type": "string"
            },
            "semver": {
              "type": "string"
            },
            "examples": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "rules": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "automation": {
          "type": "object",
          "properties": {
            "changelog": {
              "type": "string"
            },
            "versioning": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "CommitType": {
      "type": "object",
      "required": ["type", "description"],
      "properties": {
        "type": {
          "type": "string",
          "pattern": "^[a-z]+$"
        },
        "description": {
          "type": "string"
        },
        "semver": {
          "type": ["string", "null"]
        },
        "example": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "ChangeManagement": {
      "type": "object",
      "properties": {
        "breaking_changes": {
          "type": "object",
          "properties": {
            "required": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "migration_template": {
              "type": "string"
            }
          }
        },
        "rollback": {
          "type": "object",
          "properties": {
            "principles": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "procedure": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            },
            "documentation": {
              "type": "string"
            }
          }
        },
        "hotfix": {
          "type": "object",
          "properties": {
            "process": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "template": {
              "type": "string"
            }
          }
        }
      },
      "additionalProperties": false
    },
    "ErrorHandling": {
      "type": "object",
      "properties": {
        "principles": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "strategies": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/ErrorStrategy"
          }
        },
        "recovery": {
          "type": "object",
          "properties": {
            "retry": {
              "type": "object",
              "properties": {
                "deterministic_ops": {
                  "type": "boolean"
                },
                "network_ops": {
                  "type": "boolean"
                },
                "max_attempts": {
                  "type": "integer",
                  "minimum": 1
                },
                "backoff": {
                  "type": "string"
                }
              }
            },
            "fallback": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "ErrorStrategy": {
      "type": "object",
      "required": ["action"],
      "properties": {
        "action": {
          "type": "string"
        },
        "output": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "MonorepoSupport": {
      "type": "object",
      "properties": {
        "detection": {
          "type": "object",
          "properties": {
            "indicators": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "tools": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            }
          }
        },
        "strategies": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "package_schema": {
          "$ref": "#/$defs/JsonSchemaDefinition"
        }
      },
      "additionalProperties": false
    },
    "ScalingRules": {
      "type": "object",
      "properties": {
        "tiers": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/ScalingTier"
          }
        }
      },
      "additionalProperties": false
    },
    "ScalingTier": {
      "type": "object",
      "required": ["criteria"],
      "properties": {
        "criteria": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "include": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "skip": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "VerificationCommands": {
      "type": "object",
      "properties": {
        "detection": {
          "type": "object",
          "properties": {
            "commands": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "languages": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/LanguageCommands"
          }
        }
      },
      "additionalProperties": false
    },
    "LanguageCommands": {
      "type": "object",
      "properties": {
        "setup": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "test": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "lint": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "format": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "security": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "build": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "Troubleshooting": {
      "type": "object",
      "properties": {
        "common_issues": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/TroubleshootingIssue"
          }
        },
        "debugging_tips": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "escalation": {
          "type": "object",
          "properties": {
            "when_to_escalate": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "how_to_escalate": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "TroubleshootingIssue": {
      "type": "object",
      "required": ["issue"],
      "properties": {
        "issue": {
          "type": "string"
        },
        "causes": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "solutions": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "AdvancedFeatures": {
      "type": "object",
      "properties": {
        "mutation_testing": {
          "$ref": "#/$defs/AdvancedFeature"
        },
        "property_based_testing": {
          "$ref": "#/$defs/AdvancedFeature"
        },
        "chaos_engineering": {
          "$ref": "#/$defs/AdvancedFeature"
        },
        "incident_response": {
          "type": "object",
          "properties": {
            "playbook_template": {
              "type": "string"
            }
          }
        },
        "technical_debt": {
          "type": "object",
          "properties": {
            "tracking": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "categories": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "prioritization": {
              "type": "object",
              "properties": {
                "formula": {
                  "type": "string"
                },
                "criteria": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      },
      "additionalProperties": true
    },
    "AdvancedFeature": {
      "type": "object",
      "properties": {
        "description": {
          "type": "string"
        },
        "tools": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            }
          ]
        },
        "when_to_use": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "use_cases": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "target_score": {
          "type": "string"
        },
        "principles": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "experiments": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": true
    },
    "Notes": {
      "type": "object",
      "properties": {
        "principles": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "anti_patterns": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "success_factors": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "continuous_improvement": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "DiscoveryReport": {
      "title": "Discovery Report Output",
      "description": "Schema for discovery_agent output",
      "type": "object",
      "required": ["repo_metadata", "languages", "tooling", "gaps", "risk_assessment"],
      "properties": {
        "repo_metadata": {
          "type": "object",
          "required": ["name", "primary_language", "repo_type", "loc", "file_count"],
          "properties": {
            "name": {
              "type": "string"
            },
            "description": {
              "type": "string"
            },
            "primary_language": {
              "type": "string"
            },
            "repo_type": {
              "type": "string",
              "enum": ["library", "application", "service", "cli", "monorepo", "unknown"]
            },
            "loc": {
              "type": "integer",
              "minimum": 0
            },
            "file_count": {
              "type": "integer",
              "minimum": 0
            },
            "last_commit_date": {
              "type": "string",
              "format": "date-time"
            },
            "contributors": {
              "type": "integer",
              "minimum": 0
            },
            "open_issues": {
              "type": "integer",
              "minimum": 0
            },
            "open_prs": {
              "type": "integer",
              "minimum": 0
            },
            "stars": {
              "type": ["integer", "null"],
              "minimum": 0
            },
            "license": {
              "type": ["string", "null"]
            }
          }
        },
        "languages": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "percentage"],
            "properties": {
              "name": {
                "type": "string"
              },
              "percentage": {
                "type": "number",
                "minimum": 0,
                "maximum": 100
              },
              "package_manager": {
                "type": ["string", "null"]
              },
              "lockfile_present": {
                "type": "boolean"
              },
              "version_detected": {
                "type": ["string", "null"]
              }
            }
          }
        },
        "tooling": {
          "type": "object",
          "properties": {
            "test_framework": {
              "type": ["string", "null"]
            },
            "test_location": {
              "type": ["string", "null"]
            },
            "linter": {
              "type": ["string", "null"]
            },
            "formatter": {
              "type": ["string", "null"]
            },
            "type_checker": {
              "type": ["string", "null"]
            },
            "build_tool": {
              "type": ["string", "null"]
            },
            "ci_platform": {
              "type": ["string", "null"]
            },
            "ci_workflows": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "containerization": {
              "type": ["string", "null"]
            },
            "iac_tool": {
              "type": ["string", "null"]
            }
          }
        },
        "monorepo": {
          "type": ["object", "null"],
          "properties": {
            "is_monorepo": {
              "type": "boolean"
            },
            "tool": {
              "type": "string",
              "enum": ["nx", "turborepo", "lerna", "bazel", "pnpm", "rush", "custom", "none"]
            },
            "packages": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "path": {
                    "type": "string"
                  },
                  "language": {
                    "type": "string"
                  },
                  "type": {
                    "type": "string",
                    "enum": ["app", "lib", "service", "tool"]
                  }
                }
              }
            }
          }
        },
        "gaps": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Gap"
          }
        },
        "risk_assessment": {
          "type": "object",
          "required": ["overall_risk"],
          "properties": {
            "overall_risk": {
              "type": "string",
              "enum": ["low", "medium", "high", "critical"]
            },
            "risk_factors": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "factor": {
                    "type": "string"
                  },
                  "severity": {
                    "type": "string"
                  },
                  "mitigation": {
                    "type": "string"
                  }
                }
              }
            },
            "technical_debt_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "production_readiness_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        }
      },
      "additionalProperties": false
    },
    "Gap": {
      "type": "object",
      "required": ["id", "category", "severity", "title"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[A-Z]+-\\d+$"
        },
        "category": {
          "type": "string",
          "enum": ["tests", "docs", "ci", "security", "governance", "performance", "dx"]
        },
        "severity": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"]
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "impact": {
          "type": "string"
        },
        "suggested_fix": {
          "type": "string"
        },
        "effort_estimate": {
          "type": "string",
          "enum": ["trivial", "small", "medium", "large", "xlarge"]
        },
        "files_affected": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "PlanOutput": {
      "title": "Plan Output",
      "description": "Schema for planning_agent output",
      "type": "object",
      "required": ["backlog", "selected_items", "execution_order", "estimated_effort"],
      "properties": {
        "backlog": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/BacklogItem"
          }
        },
        "selected_items": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "execution_order": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "risk_analysis": {
          "type": "object",
          "properties": {
            "breaking_changes_possible": {
              "type": "boolean"
            },
            "requires_manual_review": {
              "type": "boolean"
            },
            "rollback_complexity": {
              "type": "string",
              "enum": ["trivial", "moderate", "complex"]
            },
            "affected_packages": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "estimated_effort": {
          "type": "object",
          "required": ["total_minutes", "confidence"],
          "properties": {
            "total_minutes": {
              "type": "integer",
              "minimum": 0
            },
            "confidence": {
              "type": "string",
              "enum": ["low", "medium", "high"]
            },
            "breakdown": {
              "type": "object",
              "additionalProperties": {
                "type": "integer"
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "BacklogItem": {
      "type": "object",
      "required": ["id", "priority", "title"],
      "properties": {
        "id": {
          "type": "string"
        },
        "priority": {
          "type": "string",
          "enum": ["P0", "P1", "P2", "P3"]
        },
        "category": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "scope": {
          "type": "object",
          "properties": {
            "files": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "packages": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "risk": {
          "type": "string",
          "enum": ["low", "medium", "high"]
        },
        "estimated_effort_minutes": {
          "type": "integer",
          "minimum": 0
        },
        "verification_method": {
          "type": "string"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "acceptance_criteria": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "ExecutionOutput": {
      "title": "Execution Output",
      "description": "Schema for execution_agent output",
      "type": "object",
      "required": ["changes", "commits", "local_verification"],
      "properties": {
        "changes": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/FileChange"
          }
        },
        "commits": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Commit"
          }
        },
        "local_verification": {
          "$ref": "#/$defs/LocalVerification"
        },
        "artifacts": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Artifact"
          }
        }
      },
      "additionalProperties": false
    },
    "FileChange": {
      "type": "object",
      "required": ["file_path", "change_type"],
      "properties": {
        "file_path": {
          "type": "string"
        },
        "change_type": {
          "type": "string",
          "enum": ["create", "modify", "delete", "rename", "chmod"]
        },
        "old_path": {
          "type": ["string", "null"]
        },
        "diff": {
          "type": "string"
        },
        "full_content": {
          "type": ["string", "null"]
        },
        "rationale": {
          "type": "string"
        },
        "backlog_item_id": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "Commit": {
      "type": "object",
      "required": ["message", "files"],
      "properties": {
        "hash": {
          "type": ["string", "null"]
        },
        "message": {
          "type": "string"
        },
        "files": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "type": {
          "type": "string"
        },
        "scope": {
          "type": ["string", "null"]
        },
        "breaking": {
          "type": "boolean"
        },
        "backlog_item_ids": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "LocalVerification": {
      "type": "object",
      "properties": {
        "tests": {
          "$ref": "#/$defs/VerificationResult"
        },
        "lint": {
          "$ref": "#/$defs/VerificationResult"
        },
        "build": {
          "$ref": "#/$defs/VerificationResult"
        },
        "type_check": {
          "$ref": "#/$defs/VerificationResult"
        }
      },
      "additionalProperties": false
    },
    "VerificationResult": {
      "type": "object",
      "required": ["executed"],
      "properties": {
        "executed": {
          "type": "boolean"
        },
        "passed": {
          "type": "boolean"
        },
        "details": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "Artifact": {
      "type": "object",
      "required": ["name", "path", "type"],
      "properties": {
        "name": {
          "type": "string"
        },
        "path": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": ["patch", "sbom", "report", "script", "config", "documentation"]
        },
        "description": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "VerificationOutput": {
      "title": "Verification Output",
      "description": "Schema for verification_agent output",
      "type": "object",
      "required": ["verification_results", "metrics", "recommendations"],
      "properties": {
        "verification_results": {
          "type": "object",
          "required": ["overall_status"],
          "properties": {
            "overall_status": {
              "type": "string",
              "enum": ["passed", "passed_with_warnings", "failed"]
            },
            "tests": {
              "$ref": "#/$defs/TestResults"
            },
            "lint": {
              "$ref": "#/$defs/LintResults"
            },
            "security": {
              "$ref": "#/$defs/SecurityResults"
            },
            "build": {
              "$ref": "#/$defs/BuildResults"
            },
            "type_check": {
              "$ref": "#/$defs/TypeCheckResults"
            }
          }
        },
        "metrics": {
          "$ref": "#/$defs/MetricsOutput"
        },
        "audit_trail": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/AuditEntry"
          }
        },
        "recommendations": {
          "$ref": "#/$defs/Recommendations"
        },
        "final_report": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "TestResults": {
      "type": "object",
      "properties": {
        "executed": {
          "type": "boolean"
        },
        "passed": {
          "type": "integer",
          "minimum": 0
        },
        "failed": {
          "type": "integer",
          "minimum": 0
        },
        "skipped": {
          "type": "integer",
          "minimum": 0
        },
        "duration_seconds": {
          "type": "number",
          "minimum": 0
        },
        "coverage_before": {
          "type": ["number", "null"],
          "minimum": 0,
          "maximum": 100
        },
        "coverage_after": {
          "type": ["number", "null"],
          "minimum": 0,
          "maximum": 100
        },
        "flaky_tests": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "new_tests_added": {
          "type": "integer",
          "minimum": 0
        }
      },
      "additionalProperties": false
    },
    "LintResults": {
      "type": "object",
      "properties": {
        "executed": {
          "type": "boolean"
        },
        "violations_before": {
          "type": "integer",
          "minimum": 0
        },
        "violations_after": {
          "type": "integer",
          "minimum": 0
        },
        "auto_fixed": {
          "type": "integer",
          "minimum": 0
        },
        "new_violations": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "SecurityResults": {
      "type": "object",
      "properties": {
        "secret_scan": {
          "type": "object",
          "properties": {
            "executed": {
              "type": "boolean"
            },
            "passed": {
              "type": "boolean"
            },
            "findings": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "dependency_scan": {
          "type": "object",
          "properties": {
            "executed": {
              "type": "boolean"
            },
            "passed": {
              "type": "boolean"
            },
            "critical": {
              "type": "integer",
              "minimum": 0
            },
            "high": {
              "type": "integer",
              "minimum": 0
            },
            "medium": {
              "type": "integer",
              "minimum": 0
            },
            "low": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "sast_scan": {
          "type": "object",
          "properties": {
            "executed": {
              "type": "boolean"
            },
            "passed": {
              "type": "boolean"
            },
            "findings": {
              "type": "integer",
              "minimum": 0
            }
          }
        }
      },
      "additionalProperties": false
    },
    "BuildResults": {
      "type": "object",
      "properties": {
        "executed": {
          "type": "boolean"
        },
        "succeeded": {
          "type": "boolean"
        },
        "warnings": {
          "type": "integer",
          "minimum": 0
        },
        "duration_seconds": {
          "type": "number",
          "minimum": 0
        }
      },
      "additionalProperties": false
    },
    "TypeCheckResults": {
      "type": "object",
      "properties": {
        "executed": {
          "type": "boolean"
        },
        "passed": {
          "type": "boolean"
        },
        "errors": {
          "type": "integer",
          "minimum": 0
        }
      },
      "additionalProperties": false
    },
    "MetricsOutput": {
      "type": "object",
      "properties": {
        "files_changed": {
          "type": "integer",
          "minimum": 0
        },
        "files_created": {
          "type": "integer",
          "minimum": 0
        },
        "files_deleted": {
          "type": "integer",
          "minimum": 0
        },
        "lines_added": {
          "type": "integer",
          "minimum": 0
        },
        "lines_removed": {
          "type": "integer",
          "minimum": 0
        },
        "test_coverage_delta": {
          "type": "number"
        },
        "lint_violations_delta": {
          "type": "integer"
        },
        "security_findings_delta": {
          "type": "integer"
        },
        "build_time_delta_seconds": {
          "type": "number"
        },
        "technical_debt_delta": {
          "type": "number"
        },
        "production_readiness_delta": {
          "type": "number"
        }
      },
      "additionalProperties": false
    },
    "AuditEntry": {
      "type": "object",
      "required": ["timestamp", "agent", "action", "result"],
      "properties": {
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "agent": {
          "type": "string"
        },
        "action": {
          "type": "string"
        },
        "result": {
          "type": "string",
          "enum": ["success", "warning", "failure", "skipped"]
        },
        "duration_ms": {
          "type": "integer",
          "minimum": 0
        },
        "details": {
          "type": "object"
        }
      },
      "additionalProperties": false
    },
    "Recommendations": {
      "type": "object",
      "required": ["ready_for_pr"],
      "properties": {
        "ready_for_pr": {
          "type": "boolean"
        },
        "pr_title": {
          "type": "string"
        },
        "pr_description": {
          "type": "string"
        },
        "pr_labels": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "required_reviewers": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "required_actions_before_merge": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "followup_items": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "risk_assessment": {
          "type": "string"
        }
      },
      "additionalProperties": false
    }
  }
}
