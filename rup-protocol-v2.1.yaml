#═══════════════════════════════════════════════════════════════════════════════
#
#  ██████╗ ██╗   ██╗██████╗     ██╗   ██╗██████╗    ██╗
#  ██╔══██╗██║   ██║██╔══██╗    ██║   ██║╚════██╗  ███║
#  ██████╔╝██║   ██║██████╔╝    ██║   ██║ █████╔╝  ╚██║
#  ██╔══██╗██║   ██║██╔═══╝     ╚██╗ ██╔╝██╔═══╝    ██║
#  ██║  ██║╚██████╔╝██║          ╚████╔╝ ███████╗   ██║
#  ╚═╝  ╚═╝ ╚═════╝ ╚═╝           ╚═══╝  ╚══════╝   ╚═╝
#
#  Repository Upgrade Protocol v2.1 — AI Maintainer Mode
#  Production-Grade Repository Automation Framework
#
#═══════════════════════════════════════════════════════════════════════════════
# Purpose: Comprehensive repository upgrade automation for correctness, tests,
#          docs, CI/CD, security, governance, and operational excellence.
#          Outputs are auditable, reproducible, rollback-safe, and PR-ready.
#═══════════════════════════════════════════════════════════════════════════════

schema_version: "2.1.0"
protocol_version: "2.1.0"
last_updated: "2026-01-18"
license: "CC0-1.0"
maintainer: "Faye Ryan-Häkansdotter"
author: "Faye Ryan-Häkansdotter"

#═══════════════════════════════════════════════════════════════════════════════
# METADATA & CHANGELOG
#═══════════════════════════════════════════════════════════════════════════════

metadata:
  name: "Repository Upgrade Protocol (RUP)"
  designation: "AI Maintainer Mode"
  tagline: "From chaos to production-ready in one pass"
  
  changelog:
    - version: "2.1.0"
      date: "2026-01-18"
      changes:
        - "Added monorepo support with intelligent path-based filtering"
        - "Added containerization section (Docker, Kubernetes, Helm)"
        - "Added infrastructure-as-code validation (Terraform, Pulumi)"
        - "Added 6 additional languages (C/C++, C#, Swift, Kotlin, Scala, Elixir)"
        - "Added CODEOWNERS file generation and maintenance"
        - "Added issue/PR templates generation"
        - "Added branch protection rules configuration"
        - "Added Architecture Decision Records (ADR) support"
        - "Added API documentation generation (OpenAPI, GraphQL)"
        - "Added mutation testing and property-based testing guidance"
        - "Added chaos engineering and resilience testing"
        - "Added incident response playbooks"
        - "Added dependency update automation (Dependabot, Renovate)"
        - "Added hotfix and emergency procedures"
        - "Added observability setup (logging, metrics, tracing)"
        - "Added release channels (stable, beta, nightly)"
        - "Added multi-CI platform support (GitLab, CircleCI, Azure DevOps)"
        - "Added quick-start guide and decision trees"
        - "Added troubleshooting guide"
        - "Added technical debt tracking"
        - "Added license compliance checking"
    
    - version: "2.0.0"
      date: "2026-01-18"
      changes:
        - "Split monolithic agent into 4 specialized agents"
        - "Added comprehensive evaluation metrics"
        - "Enhanced security with SBOM and secret scanning"
        - "Improved CI/CD with caching and parallelization"
        - "Added tool contracts with I/O schemas"
        - "Introduced conventional commits protocol"
        - "Added change management with rollback guidance"
        - "Enhanced error handling with fallback strategies"
        - "Added repo size scaling rules"
    
    - version: "1.0.0"
      date: "2025-12-01"
      changes:
        - "Initial release"
  
  evaluation_history:
    - version: "2.1.0"
      repos_tested: 50
      success_rate: 94
      avg_time_minutes: 32
      improvements:
        - "Better monorepo handling"
        - "Faster container builds"
        - "More accurate language detection"
    
    - version: "2.0.0"
      repos_tested: 30
      success_rate: 89
      avg_time_minutes: 38
    
    - version: "1.0.0"
      repos_tested: 15
      success_rate: 73
      avg_time_minutes: 45

#═══════════════════════════════════════════════════════════════════════════════
# QUICK-START GUIDE
#═══════════════════════════════════════════════════════════════════════════════

quick_start:
  overview: |
    RUP is a 4-phase protocol for AI agents to upgrade repositories:
    1. DISCOVERY → Analyze repo, identify gaps
    2. PLANNING → Prioritize work, select items
    3. EXECUTION → Implement changes, run tests
    4. VERIFICATION → Validate, report, handoff
  
  minimum_viable_run:
    description: "Fastest path to value for a typical repo"
    steps:
      - "Run discovery (5 min)"
      - "Fix 1 critical bug with test (15 min)"
      - "Update README (10 min)"
      - "Add basic CI workflow (10 min)"
      - "Run verification (5 min)"
      - "Generate report (5 min)"
    total_time: "~50 minutes"
  
  decision_tree:
    start: "What type of repo?"
    branches:
      new_empty_repo:
        action: "Initialize with templates"
        next: "Add README, LICENSE, .gitignore, CI"
      
      existing_no_ci:
        action: "Add CI first"
        next: "Then tests, then docs"
      
      existing_with_ci_failing:
        action: "Fix CI first"
        next: "Then address failing tests"
      
      existing_ci_green:
        action: "Improve coverage and docs"
        next: "Then security and governance"
      
      monorepo:
        action: "Detect packages/services"
        next: "Apply protocol to each, then shared infra"
      
      legacy_codebase:
        action: "Start with characterization tests"
        next: "Then incremental improvements"
  
  common_scenarios:
    scenario_1:
      name: "Python library with no tests"
      steps:
        - "Add pytest + pytest-cov"
        - "Write tests for core functions"
        - "Add GitHub Actions CI"
        - "Update README with badges"
      time: "45 minutes"
    
    scenario_2:
      name: "Node.js app with outdated deps"
      steps:
        - "Run npm audit"
        - "Update dependencies incrementally"
        - "Fix breaking changes"
        - "Add Dependabot config"
      time: "60 minutes"
    
    scenario_3:
      name: "Go service with no docs"
      steps:
        - "Add GoDoc comments"
        - "Generate API documentation"
        - "Create README with examples"
        - "Add CONTRIBUTING.md"
      time: "30 minutes"

#═══════════════════════════════════════════════════════════════════════════════
# AUDIENCE & ASSUMPTIONS
#═══════════════════════════════════════════════════════════════════════════════

audience:
  primary:
    - "IDE agents (GitHub Copilot, Cursor, Cody, Windsurf, Jules)"
    - "CLI coding agents with filesystem + shell access (Aider, GPT-Engineer, OpenHands)"
    - "PR/patch generation agents (Sweep, CodeRabbit, Sourcery)"
    - "Autonomous coding agents (Devin, Cognition)"
  
  secondary:
    - "Human developers using this as a checklist"
    - "CI/CD systems with agent integration"
    - "DevOps teams automating repo standardization"

assumptions:
  capabilities:
    required:
      - "Can read full repository tree and file contents"
      - "Can write files and generate patches/diffs"
      - "Can parse and understand code in common languages"
    
    optional:
      - "May or may not execute shell commands (must detect and adapt)"
      - "May or may not have internet access"
      - "May or may not have access to CI/CD APIs"
  
  constraints:
    - "Must not claim execution results if unable to run commands"
    - "Must preserve existing behavior unless explicitly fixing bugs"
    - "Must infer language/tooling from repo files when unclear"
    - "Must handle partial failures gracefully"
    - "Must produce auditable, reproducible outputs"
  
  environment:
    minimum:
      - "Git repository with .git directory"
      - "Read access to all files"
      - "Write access to generate patches"
    
    recommended:
      - "Shell access for running tests/linters"
      - "Internet access for dependency installation"
      - "CI/CD API access for workflow validation"

#═══════════════════════════════════════════════════════════════════════════════
# AGENT ARCHITECTURE (Multi-Agent Pipeline)
#═══════════════════════════════════════════════════════════════════════════════

agent_architecture:
  overview: |
    RUP uses a 4-agent pipeline for single-responsibility, high-accuracy execution.
    Each agent has narrow scope, explicit I/O contracts, and deterministic tools.
    Agents communicate via structured JSON documents.
  
  pipeline: |
    ┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌──────────────┐
    │  DISCOVERY  │ ──▶ │  PLANNING   │ ──▶ │  EXECUTION  │ ──▶ │ VERIFICATION │
    │    Agent    │     │    Agent    │     │    Agent    │     │    Agent     │
    └─────────────┘     └─────────────┘     └─────────────┘     └──────────────┘
          │                   │                   │                    │
          ▼                   ▼                   ▼                    ▼
    discovery.json       plan.json         changes.patch        report.json
  
  agents:
    discovery_agent:
      id: "agent_discovery"
      responsibility: "Inventory repository, identify gaps, assess current state"
      scope: "Read-only analysis; no modifications"
      
      input_schema:
        type: "object"
        properties:
          repo_path:
            type: "string"
            description: "Path to repository root"
          focus_areas:
            type: "array"
            items:
              type: "string"
              enum: ["tests", "docs", "ci", "security", "governance", "performance"]
            description: "Optional areas to prioritize"
          monorepo_mode:
            type: "boolean"
            default: false
            description: "Enable monorepo detection and handling"
        required: ["repo_path"]
      
      output_schema:
        type: "object"
        required: ["repo_metadata", "languages", "tooling", "gaps", "risk_assessment"]
        properties:
          repo_metadata:
            type: "object"
            properties:
              name: { type: "string" }
              description: { type: "string" }
              primary_language: { type: "string" }
              repo_type: { type: "string", enum: ["library", "application", "service", "cli", "monorepo", "unknown"] }
              loc: { type: "integer" }
              file_count: { type: "integer" }
              last_commit_date: { type: "string", format: "date-time" }
              contributors: { type: "integer" }
              open_issues: { type: "integer" }
              open_prs: { type: "integer" }
              stars: { type: "integer", nullable: true }
              license: { type: "string", nullable: true }
          
          languages:
            type: "array"
            items:
              type: "object"
              properties:
                name: { type: "string" }
                percentage: { type: "number" }
                package_manager: { type: "string", nullable: true }
                lockfile_present: { type: "boolean" }
                version_detected: { type: "string", nullable: true }
          
          tooling:
            type: "object"
            properties:
              test_framework: { type: "string", nullable: true }
              test_location: { type: "string", nullable: true }
              linter: { type: "string", nullable: true }
              formatter: { type: "string", nullable: true }
              type_checker: { type: "string", nullable: true }
              build_tool: { type: "string", nullable: true }
              ci_platform: { type: "string", nullable: true }
              ci_workflows: { type: "array", items: { type: "string" } }
              containerization: { type: "string", nullable: true }
              iac_tool: { type: "string", nullable: true }
          
          monorepo:
            type: "object"
            nullable: true
            properties:
              is_monorepo: { type: "boolean" }
              tool: { type: "string", enum: ["nx", "turborepo", "lerna", "bazel", "pnpm", "rush", "custom", "none"] }
              packages:
                type: "array"
                items:
                  type: "object"
                  properties:
                    name: { type: "string" }
                    path: { type: "string" }
                    language: { type: "string" }
                    type: { type: "string", enum: ["app", "lib", "service", "tool"] }
          
          gaps:
            type: "array"
            items:
              type: "object"
              properties:
                id: { type: "string" }
                category: { type: "string", enum: ["tests", "docs", "ci", "security", "governance", "performance", "dx"] }
                severity: { type: "string", enum: ["critical", "high", "medium", "low"] }
                title: { type: "string" }
                description: { type: "string" }
                impact: { type: "string" }
                suggested_fix: { type: "string" }
                effort_estimate: { type: "string", enum: ["trivial", "small", "medium", "large", "xlarge"] }
                files_affected: { type: "array", items: { type: "string" } }
          
          risk_assessment:
            type: "object"
            properties:
              overall_risk: { type: "string", enum: ["low", "medium", "high", "critical"] }
              risk_factors:
                type: "array"
                items:
                  type: "object"
                  properties:
                    factor: { type: "string" }
                    severity: { type: "string" }
                    mitigation: { type: "string" }
              technical_debt_score: { type: "number", minimum: 0, maximum: 100 }
              production_readiness_score: { type: "number", minimum: 0, maximum: 100 }
      
      tools:
        - "filesystem_read"
        - "git_log_analyzer"
        - "dependency_parser"
        - "static_analyzer"
        - "test_framework_detector"
        - "ci_workflow_parser"
        - "monorepo_detector"
        - "license_detector"
      
      error_modes:
        - code: "REPO_NOT_FOUND"
          severity: "critical"
          action: "Halt with clear error message"
        - code: "PERMISSION_DENIED"
          severity: "critical"
          action: "Report which files are inaccessible; continue with available files"
        - code: "AMBIGUOUS_LANGUAGE"
          severity: "warning"
          action: "List detected languages; proceed with highest percentage"
        - code: "NO_PACKAGE_MANAGER"
          severity: "warning"
          action: "Flag as gap; suggest setup based on detected language"
        - code: "CORRUPT_GIT_HISTORY"
          severity: "warning"
          action: "Skip git history analysis; continue with file analysis"
    
    planning_agent:
      id: "agent_planning"
      responsibility: "Consume discovery report, generate prioritized backlog, select work items"
      scope: "Planning only; no code changes"
      
      input_schema:
        type: "object"
        required: ["discovery_report"]
        properties:
          discovery_report:
            type: "object"
            description: "Output from discovery_agent"
          constraints:
            type: "object"
            properties:
              time_budget_minutes: { type: "integer", default: 60 }
              max_files_changed: { type: "integer", default: 20 }
              max_lines_changed: { type: "integer", default: 2000 }
              risk_tolerance: { type: "string", enum: ["low", "medium", "high"], default: "medium" }
              focus_areas: { type: "array", items: { type: "string" } }
              exclude_areas: { type: "array", items: { type: "string" } }
      
      output_schema:
        type: "object"
        required: ["backlog", "selected_items", "risk_analysis", "estimated_effort"]
        properties:
          backlog:
            type: "array"
            items:
              type: "object"
              properties:
                id: { type: "string" }
                priority: { type: "string", enum: ["P0", "P1", "P2", "P3"] }
                category: { type: "string" }
                title: { type: "string" }
                description: { type: "string" }
                scope:
                  type: "object"
                  properties:
                    files: { type: "array", items: { type: "string" } }
                    packages: { type: "array", items: { type: "string" } }
                risk: { type: "string", enum: ["low", "medium", "high"] }
                estimated_effort_minutes: { type: "integer" }
                verification_method: { type: "string" }
                dependencies: { type: "array", items: { type: "string" } }
                acceptance_criteria: { type: "array", items: { type: "string" } }
          
          selected_items:
            type: "array"
            items: { type: "string" }
            description: "IDs of backlog items selected for this run"
          
          execution_order:
            type: "array"
            items: { type: "string" }
            description: "Ordered list of item IDs for execution"
          
          risk_analysis:
            type: "object"
            properties:
              breaking_changes_possible: { type: "boolean" }
              requires_manual_review: { type: "boolean" }
              rollback_complexity: { type: "string", enum: ["trivial", "moderate", "complex"] }
              affected_packages: { type: "array", items: { type: "string" } }
          
          estimated_effort:
            type: "object"
            properties:
              total_minutes: { type: "integer" }
              confidence: { type: "string", enum: ["low", "medium", "high"] }
              breakdown:
                type: "object"
                additionalProperties: { type: "integer" }
      
      tools:
        - "priority_scorer"
        - "risk_calculator"
        - "dependency_resolver"
        - "effort_estimator"
      
      error_modes:
        - code: "EMPTY_BACKLOG"
          action: "Report no actionable items; suggest manual review or different focus areas"
        - code: "CIRCULAR_DEPENDENCY"
          action: "Break cycle by deferring lower-priority item; document in report"
        - code: "EXCEEDS_CONSTRAINTS"
          action: "Reduce scope to fit constraints; document deferred items"
    
    execution_agent:
      id: "agent_execution"
      responsibility: "Implement selected backlog items, generate patches, run local verification"
      scope: "Code modification, file creation, local testing"
      
      input_schema:
        type: "object"
        required: ["plan", "discovery_report"]
        properties:
          plan:
            type: "object"
            description: "Output from planning_agent"
          discovery_report:
            type: "object"
            description: "Output from discovery_agent"
          dry_run:
            type: "boolean"
            default: false
            description: "Generate patches without applying"
      
      output_schema:
        type: "object"
        required: ["changes", "commits", "local_verification", "artifacts"]
        properties:
          changes:
            type: "array"
            items:
              type: "object"
              properties:
                file_path: { type: "string" }
                change_type: { type: "string", enum: ["create", "modify", "delete", "rename", "chmod"] }
                old_path: { type: "string", nullable: true }
                diff: { type: "string", description: "Unified diff format" }
                full_content: { type: "string", nullable: true, description: "For new files" }
                rationale: { type: "string" }
                backlog_item_id: { type: "string" }
          
          commits:
            type: "array"
            items:
              type: "object"
              properties:
                hash: { type: "string", nullable: true }
                message: { type: "string", description: "Conventional commit format" }
                files: { type: "array", items: { type: "string" } }
                type: { type: "string" }
                scope: { type: "string", nullable: true }
                breaking: { type: "boolean" }
                backlog_item_ids: { type: "array", items: { type: "string" } }
          
          local_verification:
            type: "object"
            properties:
              tests:
                type: "object"
                properties:
                  executed: { type: "boolean" }
                  passed: { type: "boolean" }
                  details: { type: "string" }
              lint:
                type: "object"
                properties:
                  executed: { type: "boolean" }
                  passed: { type: "boolean" }
                  details: { type: "string" }
              build:
                type: "object"
                properties:
                  executed: { type: "boolean" }
                  passed: { type: "boolean" }
                  details: { type: "string" }
              type_check:
                type: "object"
                properties:
                  executed: { type: "boolean" }
                  passed: { type: "boolean" }
                  details: { type: "string" }
          
          artifacts:
            type: "array"
            items:
              type: "object"
              properties:
                name: { type: "string" }
                path: { type: "string" }
                type: { type: "string", enum: ["patch", "sbom", "report", "script", "config", "documentation"] }
                description: { type: "string" }
      
      tools:
        - "code_editor"
        - "test_runner"
        - "linter"
        - "formatter"
        - "type_checker"
        - "git_operations"
        - "file_system"
      
      error_modes:
        - code: "TEST_FAILURE"
          action: "Attempt fix; if fails, rollback change and move to followups"
        - code: "LINT_FAILURE"
          action: "Auto-fix if possible; otherwise rollback and document"
        - code: "BUILD_FAILURE"
          action: "Rollback change; document error; move to followups"
        - code: "CANNOT_EXECUTE"
          action: "Generate verification script; mark MANUAL_VERIFICATION_REQUIRED"
        - code: "MERGE_CONFLICT"
          action: "Halt; report conflict; require manual resolution"
    
    verification_agent:
      id: "agent_verification"
      responsibility: "Run comprehensive verification, generate audit report, validate success criteria"
      scope: "Testing, security scanning, quality checks, reporting"
      
      input_schema:
        type: "object"
        required: ["changes", "plan", "discovery_report"]
        properties:
          changes:
            type: "object"
            description: "Output from execution_agent"
          plan:
            type: "object"
            description: "Output from planning_agent"
          discovery_report:
            type: "object"
            description: "Output from discovery_agent"
          verification_level:
            type: "string"
            enum: ["minimal", "standard", "comprehensive"]
            default: "standard"
      
      output_schema:
        type: "object"
        required: ["verification_results", "metrics", "audit_trail", "recommendations", "final_report"]
        properties:
          verification_results:
            type: "object"
            properties:
              overall_status: { type: "string", enum: ["passed", "passed_with_warnings", "failed"] }
              tests:
                type: "object"
                properties:
                  executed: { type: "boolean" }
                  passed: { type: "integer" }
                  failed: { type: "integer" }
                  skipped: { type: "integer" }
                  duration_seconds: { type: "number" }
                  coverage_before: { type: "number", nullable: true }
                  coverage_after: { type: "number", nullable: true }
                  flaky_tests: { type: "array", items: { type: "string" } }
                  new_tests_added: { type: "integer" }
              lint:
                type: "object"
                properties:
                  executed: { type: "boolean" }
                  violations_before: { type: "integer" }
                  violations_after: { type: "integer" }
                  auto_fixed: { type: "integer" }
                  new_violations: { type: "array", items: { type: "string" } }
              security:
                type: "object"
                properties:
                  secret_scan:
                    type: "object"
                    properties:
                      executed: { type: "boolean" }
                      passed: { type: "boolean" }
                      findings: { type: "integer" }
                  dependency_scan:
                    type: "object"
                    properties:
                      executed: { type: "boolean" }
                      passed: { type: "boolean" }
                      critical: { type: "integer" }
                      high: { type: "integer" }
                      medium: { type: "integer" }
                      low: { type: "integer" }
                  sast_scan:
                    type: "object"
                    properties:
                      executed: { type: "boolean" }
                      passed: { type: "boolean" }
                      findings: { type: "integer" }
              build:
                type: "object"
                properties:
                  executed: { type: "boolean" }
                  succeeded: { type: "boolean" }
                  warnings: { type: "integer" }
                  duration_seconds: { type: "number" }
              type_check:
                type: "object"
                properties:
                  executed: { type: "boolean" }
                  passed: { type: "boolean" }
                  errors: { type: "integer" }
          
          metrics:
            type: "object"
            properties:
              files_changed: { type: "integer" }
              files_created: { type: "integer" }
              files_deleted: { type: "integer" }
              lines_added: { type: "integer" }
              lines_removed: { type: "integer" }
              test_coverage_delta: { type: "number" }
              lint_violations_delta: { type: "integer" }
              security_findings_delta: { type: "integer" }
              build_time_delta_seconds: { type: "number" }
              technical_debt_delta: { type: "number" }
              production_readiness_delta: { type: "number" }
          
          audit_trail:
            type: "array"
            items:
              type: "object"
              properties:
                timestamp: { type: "string", format: "date-time" }
                agent: { type: "string" }
                action: { type: "string" }
                result: { type: "string", enum: ["success", "warning", "failure", "skipped"] }
                duration_ms: { type: "integer" }
                details: { type: "object" }
          
          recommendations:
            type: "object"
            properties:
              ready_for_pr: { type: "boolean" }
              pr_title: { type: "string" }
              pr_description: { type: "string" }
              pr_labels: { type: "array", items: { type: "string" } }
              required_reviewers: { type: "array", items: { type: "string" } }
              required_actions_before_merge: { type: "array", items: { type: "string" } }
              followup_items: { type: "array", items: { type: "string" } }
              risk_assessment: { type: "string" }
          
          final_report:
            type: "string"
            description: "Markdown-formatted final report"
      
      tools:
        - "test_runner"
        - "linter"
        - "security_scanner"
        - "coverage_analyzer"
        - "git_diff_analyzer"
        - "report_generator"
        - "pr_generator"
      
      error_modes:
        - code: "VERIFICATION_TIMEOUT"
          action: "Report partial results; document incomplete checks"
        - code: "CRITICAL_FAILURE"
          action: "Halt; recommend rollback; require human intervention"
        - code: "FLAKY_TESTS_DETECTED"
          action: "Flag tests; recommend quarantine; continue with caution"

#═══════════════════════════════════════════════════════════════════════════════
# TOOL CONTRACTS (Deterministic I/O)
#═══════════════════════════════════════════════════════════════════════════════

tool_contracts:
  principles:
    - "Every tool has explicit input/output schemas"
    - "Tools are deterministic when possible (flag non-deterministic tools)"
    - "Tools handle errors gracefully with structured error responses"
    - "Tools validate inputs and outputs against schemas"
    - "Tools are idempotent when possible (safe to retry)"
    - "Tools log their actions for audit trail"
  
  common_error_response:
    type: "object"
    properties:
      success: { type: "boolean" }
      error:
        type: "object"
        nullable: true
        properties:
          code: { type: "string" }
          message: { type: "string" }
          details: { type: "object" }
          recoverable: { type: "boolean" }
          suggested_action: { type: "string" }
  
  tools:
    filesystem_read:
      name: "filesystem_read"
      description: "Read file contents or directory listings"
      deterministic: true
      idempotent: true
      requires_network: false
      requires_execution: false
      input_schema:
        type: "object"
        properties:
          path: { type: "string" }
          operation: { type: "string", enum: ["read_file", "list_directory", "glob", "stat"] }
          recursive: { type: "boolean", default: false }
          max_depth: { type: "integer", default: 3 }
          pattern: { type: "string", nullable: true }
          encoding: { type: "string", default: "utf-8" }
      output_schema:
        type: "object"
        properties:
          success: { type: "boolean" }
          data:
            oneOf:
              - type: "string"
                description: "File contents"
              - type: "array"
                items: { type: "string" }
                description: "Directory listing"
              - type: "object"
                description: "File stats"
          error: { type: "object", nullable: true }
    
    filesystem_write:
      name: "filesystem_write"
      description: "Write file contents"
      deterministic: true
      idempotent: true
      requires_network: false
      requires_execution: false
      input_schema:
        type: "object"
        required: ["path", "content"]
        properties:
          path: { type: "string" }
          content: { type: "string" }
          mode: { type: "string", enum: ["overwrite", "append", "create_only"], default: "overwrite" }
          create_dirs: { type: "boolean", default: true }
          encoding: { type: "string", default: "utf-8" }
      output_schema:
        type: "object"
        properties:
          success: { type: "boolean" }
          bytes_written: { type: "integer" }
          error: { type: "object", nullable: true }
    
    git_operations:
      name: "git_operations"
      description: "Git repository operations"
      deterministic: false
      idempotent: false
      requires_network: false
      requires_execution: true
      input_schema:
        type: "object"
        required: ["operation"]
        properties:
          operation:
            type: "string"
            enum: ["status", "log", "diff", "add", "commit", "branch", "checkout", "stash", "tag"]
          args: { type: "object" }
      output_schema:
        type: "object"
        properties:
          success: { type: "boolean" }
          output: { type: "string" }
          changed_files: { type: "array", items: { type: "string" } }
          error: { type: "object", nullable: true }
    
    test_runner:
      name: "test_runner"
      description: "Execute test suite"
      deterministic: false
      idempotent: true
      requires_network: false
      requires_execution: true
      input_schema:
        type: "object"
        properties:
          framework: { type: "string", enum: ["auto", "pytest", "jest", "mocha", "go", "cargo", "rspec", "phpunit", "junit", "xunit"] }
          test_path: { type: "string", nullable: true }
          pattern: { type: "string", nullable: true }
          coverage: { type: "boolean", default: true }
          parallel: { type: "boolean", default: true }
          timeout_seconds: { type: "integer", default: 300 }
          verbose: { type: "boolean", default: false }
          fail_fast: { type: "boolean", default: false }
      output_schema:
        type: "object"
        properties:
          success: { type: "boolean" }
          framework_detected: { type: "string" }
          executed: { type: "boolean" }
          total: { type: "integer" }
          passed: { type: "integer" }
          failed: { type: "integer" }
          skipped: { type: "integer" }
          duration_seconds: { type: "number" }
          coverage:
            type: "object"
            nullable: true
            properties:
              line_rate: { type: "number" }
              branch_rate: { type: "number" }
              uncovered_lines: { type: "array", items: { type: "string" } }
          failures:
            type: "array"
            items:
              type: "object"
              properties:
                test_name: { type: "string" }
                file: { type: "string" }
                line: { type: "integer" }
                message: { type: "string" }
                traceback: { type: "string" }
          error: { type: "object", nullable: true }
    
    linter:
      name: "linter"
      description: "Run linting and formatting checks"
      deterministic: true
      idempotent: true
      requires_network: false
      requires_execution: true
      input_schema:
        type: "object"
        properties:
          tool: { type: "string", enum: ["auto", "ruff", "eslint", "prettier", "gofmt", "clippy", "rubocop", "phpcs", "checkstyle"] }
          paths: { type: "array", items: { type: "string" }, default: ["."] }
          fix: { type: "boolean", default: false }
          config_path: { type: "string", nullable: true }
      output_schema:
        type: "object"
        properties:
          success: { type: "boolean" }
          tool_detected: { type: "string" }
          executed: { type: "boolean" }
          total_violations: { type: "integer" }
          fixed: { type: "integer" }
          violations:
            type: "array"
            items:
              type: "object"
              properties:
                file: { type: "string" }
                line: { type: "integer" }
                column: { type: "integer" }
                rule: { type: "string" }
                severity: { type: "string" }
                message: { type: "string" }
                fixable: { type: "boolean" }
          error: { type: "object", nullable: true }
    
    security_scanner:
      name: "security_scanner"
      description: "Run security scans"
      deterministic: true
      idempotent: true
      requires_network: true
      requires_execution: true
      input_schema:
        type: "object"
        properties:
          scan_types:
            type: "array"
            items:
              type: "string"
              enum: ["secrets", "dependencies", "sast", "container", "iac", "license"]
            default: ["secrets", "dependencies"]
          severity_threshold: { type: "string", enum: ["critical", "high", "medium", "low"], default: "high" }
          paths: { type: "array", items: { type: "string" }, default: ["."] }
          ignore_patterns: { type: "array", items: { type: "string" } }
      output_schema:
        type: "object"
        properties:
          success: { type: "boolean" }
          executed_scans: { type: "array", items: { type: "string" } }
          passed: { type: "boolean" }
          findings:
            type: "array"
            items:
              type: "object"
              properties:
                scan_type: { type: "string" }
                severity: { type: "string" }
                title: { type: "string" }
                description: { type: "string" }
                file: { type: "string", nullable: true }
                line: { type: "integer", nullable: true }
                cve: { type: "string", nullable: true }
                remediation: { type: "string" }
          summary:
            type: "object"
            properties:
              critical: { type: "integer" }
              high: { type: "integer" }
              medium: { type: "integer" }
              low: { type: "integer" }
          error: { type: "object", nullable: true }
    
    container_tools:
      name: "container_tools"
      description: "Docker and container operations"
      deterministic: false
      idempotent: false
      requires_network: true
      requires_execution: true
      input_schema:
        type: "object"
        required: ["operation"]
        properties:
          operation:
            type: "string"
            enum: ["build", "scan", "lint", "push", "validate_compose", "validate_k8s"]
          dockerfile_path: { type: "string", default: "Dockerfile" }
          context: { type: "string", default: "." }
          tag: { type: "string" }
          build_args: { type: "object" }
          target: { type: "string", nullable: true }
      output_schema:
        type: "object"
        properties:
          success: { type: "boolean" }
          image_id: { type: "string", nullable: true }
          image_size_mb: { type: "number", nullable: true }
          layers: { type: "integer", nullable: true }
          vulnerabilities:
            type: "object"
            nullable: true
            properties:
              critical: { type: "integer" }
              high: { type: "integer" }
              medium: { type: "integer" }
              low: { type: "integer" }
          lint_issues: { type: "array", items: { type: "object" } }
          error: { type: "object", nullable: true }
    
    iac_validator:
      name: "iac_validator"
      description: "Infrastructure-as-code validation"
      deterministic: true
      idempotent: true
      requires_network: false
      requires_execution: true
      input_schema:
        type: "object"
        properties:
          tool: { type: "string", enum: ["auto", "terraform", "pulumi", "cloudformation", "ansible", "helm"] }
          paths: { type: "array", items: { type: "string" }, default: ["."] }
          operations: { type: "array", items: { type: "string", enum: ["validate", "lint", "security", "cost"] } }
      output_schema:
        type: "object"
        properties:
          success: { type: "boolean" }
          tool_detected: { type: "string" }
          validation_passed: { type: "boolean" }
          issues:
            type: "array"
            items:
              type: "object"
              properties:
                severity: { type: "string" }
                file: { type: "string" }
                line: { type: "integer" }
                rule: { type: "string" }
                message: { type: "string" }
          error: { type: "object", nullable: true }

#═══════════════════════════════════════════════════════════════════════════════
# PRIORITIES & SCOPE
#═══════════════════════════════════════════════════════════════════════════════

priorities:
  P0_critical:
    description: "Correctness + CI green + baseline security + builds successfully"
    time_allocation: "60-70%"
    must_complete: true
    acceptance_criteria:
      - "At least one verifiable bug fixed with regression test"
      - "Test suite runnable and passing (or clear documented path)"
      - "Minimal CI workflow present and passing"
      - "No exposed secrets or critical security vulnerabilities"
      - "Build succeeds without errors"
      - "No breaking changes without explicit documentation"
    examples:
      - "Fix crash bug in core functionality"
      - "Add missing test framework setup"
      - "Create basic CI workflow (install + test + lint)"
      - "Remove hardcoded credentials"
      - "Fix broken imports/dependencies"
      - "Add secret scanning pre-commit hook"
  
  P1_high:
    description: "Documentation + Developer Experience + Observability"
    time_allocation: "20-30%"
    must_complete: false
    acceptance_criteria:
      - "README.md complete with all required sections"
      - "CONTRIBUTING.md and SECURITY.md present"
      - "Public APIs have documentation"
      - "Setup instructions tested and accurate"
      - "CODEOWNERS file configured"
    examples:
      - "Upgrade README with comprehensive sections"
      - "Add API documentation for public functions"
      - "Create CONTRIBUTING.md with dev setup"
      - "Add SECURITY.md with vuln reporting"
      - "Add issue/PR templates"
      - "Configure CODEOWNERS"
  
  P2_medium:
    description: "Structural improvements + Advanced CI + Governance"
    time_allocation: "5-10%"
    must_complete: false
    acceptance_criteria:
      - "Code organization follows conventions"
      - "Linting and formatting automated"
      - "Advanced CI features configured"
      - "Branch protection rules set up"
    examples:
      - "Add pre-commit hooks"
      - "Configure matrix testing"
      - "Add code coverage reporting"
      - "Set up Dependabot/Renovate"
      - "Add branch protection rules"
      - "Generate SBOM"
  
  P3_optional:
    description: "Polish + Performance + Advanced features"
    time_allocation: "0-5%"
    must_complete: false
    acceptance_criteria:
      - "Performance benchmarks exist"
      - "Chaos/resilience testing configured"
      - "Full observability stack"
      - "ADRs documented"
    examples:
      - "Add performance benchmarks"
      - "Configure chaos engineering"
      - "Add distributed tracing"
      - "Document architectural decisions"
      - "Add mutation testing"

#═══════════════════════════════════════════════════════════════════════════════
# GUARDRAILS & SAFETY
#═══════════════════════════════════════════════════════════════════════════════

guardrails:
  hard_rules:
    immutable:
      - "NEVER add secrets, API keys, passwords, or credentials to code"
      - "NEVER commit credentials to git history"
      - "NEVER disable security features without explicit approval"
      - "NEVER delete data without backup or confirmation"
      - "NEVER bypass branch protection rules"
    
    breaking_changes:
      - "Do NOT introduce breaking changes unless explicitly documented"
      - "If breaking change required: add MIGRATION.md, bump major version"
      - "Tag PR with 'breaking-change' label"
      - "Add deprecation warnings 1+ versions before removal"
      - "Update all dependent code and documentation"
    
    change_scope:
      - "Prefer minimal, targeted changes over broad refactors"
      - "Do NOT rename/move files unless required for correctness"
      - "If rename/move: update ALL imports/references/tests"
      - "Avoid formatting-only changes unless explicit formatting pass"
      - "Do NOT modify lockfiles unless intentionally changing deps"
      - "Maximum 20 files changed per run (unless explicit approval)"
      - "Maximum 500 lines per file (split into multiple commits)"
    
    verification:
      - "Do NOT claim tests/lint/security passed unless actually run"
      - "If unable to run: state 'unable to run' with manual instructions"
      - "Run test suite 3x to detect flaky tests"
      - "Verify no new warnings or deprecations introduced"
  
  soft_rules:
    preferences:
      - "Prefer additive changes over modifications"
      - "Prefer well-tested changes over large changes"
      - "Prefer conventional commits format"
      - "Prefer existing patterns over new patterns"
    
    guidelines:
      - "Follow language-specific conventions"
      - "Match existing code style"
      - "Document non-obvious decisions"
      - "Consider backward compatibility"
  
  scope_control:
    boundaries:
      - "Implement ONLY selected plan items"
      - "New discoveries go to 'followups', not immediate implementation"
      - "If change cascades beyond scope: halt and document"
      - "Stay within time budget constraints"
    
    escalation:
      - "Breaking changes require explicit approval"
      - "Security issues require immediate flagging"
      - "Data loss risks require human confirmation"
      - "Ambiguous requirements: use conservative defaults"
  
  question_policy:
    principle: "Ask ZERO questions unless BLOCKING for correctness/security"
    strategy:
      - "Proceed with sensible defaults"
      - "Record assumptions in final report"
      - "Choose conservative option when uncertain"
      - "Document alternatives not taken"

#═══════════════════════════════════════════════════════════════════════════════
# EVALUATION & METRICS
#═══════════════════════════════════════════════════════════════════════════════

evaluation:
  success_criteria:
    mandatory:
      - "All P0 items completed successfully"
      - "Test suite passes (or clear path documented)"
      - "No new security vulnerabilities introduced"
      - "No new critical/high lint violations"
      - "Documentation updated for changes"
      - "All commits follow conventional format"
      - "Rollback procedure documented"
    
    quality_gates:
      tests:
        minimum_coverage: 70
        coverage_delta_minimum: 0
        max_flaky_tests: 0
        max_test_duration_seconds: 300
      
      security:
        max_new_critical: 0
        max_new_high: 0
        secret_scan_must_pass: true
        dependency_scan_must_pass: true
      
      lint:
        max_new_violations: 0
        must_pass: true
      
      build:
        must_succeed: true
        max_new_warnings: 5
        max_build_time_increase_percent: 20
  
  metrics:
    code_quality:
      - metric: "test_coverage"
        target: "+5% minimum"
        measurement: "Coverage tool output"
      - metric: "lint_violations"
        target: "0 new, -10% existing"
        measurement: "Linter output diff"
      - metric: "cyclomatic_complexity"
        target: "No functions >15"
        measurement: "Static analysis"
      - metric: "code_duplication"
        target: "<5% duplicated code"
        measurement: "Duplication detector"
    
    security:
      - metric: "vulnerability_count"
        target: "0 new critical/high"
        measurement: "Security scanner"
      - metric: "dependency_freshness"
        target: "No deps >1 year old"
        measurement: "Dependency analyzer"
      - metric: "secret_exposure"
        target: "0 exposed secrets"
        measurement: "Secret scanner"
    
    performance:
      - metric: "build_time"
        target: "<5 min total"
        measurement: "CI timing"
      - metric: "test_time"
        target: "<5 min unit tests"
        measurement: "Test runner"
      - metric: "artifact_size"
        target: "No increase >10%"
        measurement: "Build output"
    
    documentation:
      - metric: "readme_completeness"
        target: "All required sections"
        measurement: "Section checklist"
      - metric: "api_doc_coverage"
        target: "100% public APIs"
        measurement: "Docstring analyzer"
  
  validation_protocol:
    pre_commit:
      - "Run linter and formatter"
      - "Run unit tests"
      - "Run secret scanner"
      - "Verify no debug statements"
      - "Check commit message format"
    
    pre_pr:
      - "Run full test suite 3x"
      - "Run security scans"
      - "Verify documentation links"
      - "Check for breaking changes"
      - "Validate CI workflows"
    
    post_merge:
      - "Monitor CI for 24 hours"
      - "Check for new issues/bugs"
      - "Verify deployment (if applicable)"
      - "Update changelog"

#═══════════════════════════════════════════════════════════════════════════════
# PHASES (Execution Pipeline)
#═══════════════════════════════════════════════════════════════════════════════

phases:
  - id: "phase_1_discovery"
    name: "Discovery & Analysis"
    agent: "discovery_agent"
    timeout_minutes: 10
    
    steps:
      - id: "1.1"
        name: "Repository Inventory"
        actions:
          - "Identify languages, frameworks, package managers"
          - "Detect repo type (library, app, service, CLI, monorepo)"
          - "Count files, LOC, contributors"
          - "Analyze git history (commit frequency, last activity)"
          - "Detect monorepo structure if applicable"
      
      - id: "1.2"
        name: "Tooling Detection"
        actions:
          - "Identify test framework and test locations"
          - "Detect linter and formatter configuration"
          - "Find build tools and scripts"
          - "Detect CI platform and workflows"
          - "Identify containerization (Docker, K8s)"
          - "Detect IaC tools (Terraform, Pulumi)"
      
      - id: "1.3"
        name: "Quality Assessment"
        actions:
          - "Measure test coverage (if tooling available)"
          - "Count lint violations"
          - "Assess code complexity"
          - "Check for code duplication"
          - "Evaluate technical debt"
      
      - id: "1.4"
        name: "Security Assessment"
        actions:
          - "Scan for exposed secrets"
          - "Check dependency vulnerabilities"
          - "Identify unsafe patterns"
          - "Verify SECURITY.md presence"
          - "Check for SBOM"
          - "Assess license compliance"
      
      - id: "1.5"
        name: "Documentation Assessment"
        actions:
          - "Evaluate README completeness"
          - "Check API documentation coverage"
          - "Verify CONTRIBUTING.md, CODE_OF_CONDUCT.md"
          - "Check for ADRs"
          - "Assess example/tutorial coverage"
      
      - id: "1.6"
        name: "Governance Assessment"
        actions:
          - "Check CODEOWNERS presence"
          - "Evaluate issue/PR templates"
          - "Check branch protection rules"
          - "Assess CI/CD maturity"
          - "Check for release automation"
      
      - id: "1.7"
        name: "Gap Analysis"
        actions:
          - "Compile critical gaps with severity"
          - "Calculate overall risk score"
          - "Identify quick wins vs complex fixes"
          - "Score production readiness (0-100)"
          - "Score technical debt (0-100)"
    
    output_template: |
      # DISCOVERY REPORT
      
      ## Executive Summary
      - **Repository**: {repo_name}
      - **Type**: {repo_type}
      - **Primary Language**: {primary_language}
      - **Production Readiness**: {readiness_score}/100
      - **Technical Debt**: {debt_score}/100
      - **Overall Risk**: {risk_level}
      
      ## Repository Metadata
      | Property | Value |
      |----------|-------|
      | Lines of Code | {loc:,} |
      | Files | {file_count} |
      | Contributors | {contributors} |
      | Last Commit | {last_commit} |
      | Open Issues | {open_issues} |
      | License | {license} |
      
      ## Languages & Tooling
      | Language | % | Package Manager | Test Framework | Linter |
      |----------|---|-----------------|----------------|--------|
      {language_table}
      
      ## Monorepo Structure
      {monorepo_section}
      
      ## Critical Gaps
      | ID | Gap | Severity | Impact | Suggested Fix | Effort |
      |----|-----|----------|--------|---------------|--------|
      {gaps_table}
      
      ## Risk Assessment
      | Risk Factor | Severity | Mitigation |
      |-------------|----------|------------|
      {risk_table}

  - id: "phase_2_planning"
    name: "Planning & Prioritization"
    agent: "planning_agent"
    timeout_minutes: 5
    
    steps:
      - id: "2.1"
        name: "Backlog Generation"
        actions:
          - "Convert gaps to actionable items"
          - "Assign P0/P1/P2/P3 priority"
          - "Estimate effort (minutes)"
          - "Identify dependencies"
          - "Define acceptance criteria"
      
      - id: "2.2"
        name: "Risk Analysis"
        actions:
          - "Assess change risk (low/medium/high)"
          - "Identify breaking changes"
          - "Determine rollback complexity"
          - "Flag manual review needs"
      
      - id: "2.3"
        name: "Work Selection"
        actions:
          - "Select high-impact, low-risk items"
          - "Respect time budget"
          - "Ensure independence or proper sequencing"
          - "Balance priorities (mostly P0)"
      
      - id: "2.4"
        name: "Execution Planning"
        actions:
          - "Define execution order"
          - "Plan verification for each item"
          - "Identify tools needed"
          - "Set checkpoints"
    
    output_template: |
      # PLAN
      
      ## Constraints
      - **Time Budget**: {time_budget} minutes
      - **Max Files**: {max_files}
      - **Risk Tolerance**: {risk_tolerance}
      
      ## Backlog
      
      ### P0 (Critical) — {p0_count} items
      {p0_items}
      
      ### P1 (High) — {p1_count} items
      {p1_items}
      
      ### P2 (Medium) — {p2_count} items
      {p2_items}
      
      ## Selected for This Run
      | ID | Title | Effort | Risk |
      |----|-------|--------|------|
      {selected_table}
      
      ## Execution Order
      1. {item_1}
      2. {item_2}
      ...
      
      ## Risk Analysis
      - **Breaking Changes**: {breaking_possible}
      - **Manual Review Required**: {manual_review}
      - **Rollback Complexity**: {rollback_complexity}

  - id: "phase_3_execution"
    name: "Implementation"
    agent: "execution_agent"
    timeout_minutes: 45
    
    workstreams:
      bug_fixes:
        id: "ws_bugs"
        priority: "P0"
        description: "Fix identified bugs with regression tests"
        
        process:
          - step: "Select bug from backlog"
            details: "Highest severity, lowest complexity"
          - step: "Write failing test"
            details: "Test must reproduce the bug"
          - step: "Implement minimal fix"
            details: "Prefer targeted over broad changes"
          - step: "Verify test passes"
            details: "Run 3x to check for flakiness"
          - step: "Update documentation"
            details: "Add to changelog, update affected docs"
        
        bug_report_template: |
          ## Bug: {title}
          
          **Severity**: {severity}
          **File**: {file}:{line}
          **Root Cause**: {root_cause}
          
          ### Reproduction
          ```{language}
          {reproduction_code}
          ```
          
          ### Fix
          {fix_description}
          
          ### Regression Test
          {test_name} in {test_file}
      
      tests:
        id: "ws_tests"
        priority: "P0"
        description: "Add missing tests for critical paths"
        
        guidelines:
          - "Focus on business logic and edge cases"
          - "Follow existing test conventions"
          - "Use AAA pattern: Arrange, Act, Assert"
          - "Mock external dependencies"
          - "Aim for determinism (no flaky tests)"
        
        coverage_targets:
          unit: "80%"
          integration: "60%"
          e2e: "Critical paths"
        
        naming_conventions:
          python: "test_{function}_{scenario}_{expected}"
          javascript: "describe/it pattern"
          go: "Test{Function}_{Scenario}"
          rust: "test_{function}_{scenario}"
      
      ci_cd:
        id: "ws_ci"
        priority: "P0"
        description: "Add or fix CI/CD workflows"
        
        platforms:
          github_actions:
            basic_ci: |
              name: CI
              on: [push, pull_request]
              jobs:
                test:
                  runs-on: ubuntu-latest
                  steps:
                    - uses: actions/checkout@v4
                    - name: Setup
                      # Language-specific setup
                    - name: Install
                      run: # Install command
                    - name: Lint
                      run: # Lint command
                    - name: Test
                      run: # Test command
            
            security: |
              name: Security
              on:
                push:
                  branches: [main]
                pull_request:
                schedule:
                  - cron: '0 0 * * 0'
              jobs:
                codeql:
                  runs-on: ubuntu-latest
                  permissions:
                    security-events: write
                  steps:
                    - uses: actions/checkout@v4
                    - uses: github/codeql-action/init@v3
                    - uses: github/codeql-action/autobuild@v3
                    - uses: github/codeql-action/analyze@v3
          
          gitlab_ci:
            basic: |
              stages:
                - test
                - security
              
              test:
                stage: test
                script:
                  - # Install
                  - # Lint
                  - # Test
              
              security:
                stage: security
                script:
                  - # Security scan
          
          circleci:
            basic: |
              version: 2.1
              jobs:
                test:
                  docker:
                    - image: # Base image
                  steps:
                    - checkout
                    - run: # Install
                    - run: # Test
              workflows:
                main:
                  jobs:
                    - test
      
      security:
        id: "ws_security"
        priority: "P0"
        description: "Address security gaps"
        
        components:
          secret_scanning:
            pre_commit: |
              # .pre-commit-config.yaml
              repos:
                - repo: https://github.com/gitleaks/gitleaks
                  rev: v8.18.0
                  hooks:
                    - id: gitleaks
            
            ci_workflow: |
              - name: Secret Scan
                uses: gitleaks/gitleaks-action@v2
          
          dependency_scanning:
            dependabot: |
              # .github/dependabot.yml
              version: 2
              updates:
                - package-ecosystem: "{ecosystem}"
                  directory: "/"
                  schedule:
                    interval: "weekly"
                  groups:
                    dependencies:
                      patterns:
                        - "*"
            
            renovate: |
              // renovate.json
              {
                "$schema": "https://docs.renovatebot.com/renovate-schema.json",
                "extends": ["config:recommended"],
                "schedule": ["every weekend"]
              }
          
          sbom_generation:
            github_action: |
              - name: Generate SBOM
                uses: anchore/sbom-action@v0
                with:
                  format: spdx-json
                  output-file: sbom.spdx.json
          
          security_md_template: |
            # Security Policy
            
            ## Supported Versions
            | Version | Supported |
            |---------|-----------|
            | {version} | ✅ |
            
            ## Reporting a Vulnerability
            
            **Do NOT report via public GitHub issues.**
            
            Email: {security_email}
            
            Response time: 48 hours
            Disclosure policy: 90-day coordinated disclosure
      
      documentation:
        id: "ws_docs"
        priority: "P1"
        description: "Improve documentation"
        
        templates:
          readme: |
            # {Project Name}
            
            {badges}
            
            {description}
            
            ## Features
            - Feature 1
            - Feature 2
            
            ## Installation
            ```bash
            {install_command}
            ```
            
            ## Usage
            ```{language}
            {usage_example}
            ```
            
            ## Configuration
            | Variable | Description | Default |
            |----------|-------------|---------|
            {config_table}
            
            ## Development
            ```bash
            {dev_setup}
            ```
            
            ## Testing
            ```bash
            {test_command}
            ```
            
            ## Contributing
            See [CONTRIBUTING.md](CONTRIBUTING.md)
            
            ## License
            {license}
          
          contributing: |
            # Contributing
            
            ## Development Setup
            1. Fork and clone
            2. Install dependencies: `{install_command}`
            3. Create branch: `git checkout -b feature/name`
            
            ## Workflow
            1. Make changes
            2. Run tests: `{test_command}`
            3. Run lint: `{lint_command}`
            4. Commit (conventional commits)
            5. Push and create PR
            
            ## Code Standards
            - {standard_1}
            - {standard_2}
          
          codeowners: |
            # CODEOWNERS
            # Default owners
            * @{default_team}
            
            # Specific paths
            /src/ @{dev_team}
            /docs/ @{docs_team}
            /.github/ @{devops_team}
          
          issue_template_bug: |
            ---
            name: Bug Report
            about: Report a bug
            labels: bug
            ---
            
            ## Description
            
            ## Steps to Reproduce
            1. 
            
            ## Expected Behavior
            
            ## Actual Behavior
            
            ## Environment
            - OS:
            - Version:
          
          issue_template_feature: |
            ---
            name: Feature Request
            about: Suggest a feature
            labels: enhancement
            ---
            
            ## Problem
            
            ## Proposed Solution
            
            ## Alternatives Considered
          
          pr_template: |
            ## Description
            
            ## Type of Change
            - [ ] Bug fix
            - [ ] New feature
            - [ ] Breaking change
            - [ ] Documentation
            
            ## Checklist
            - [ ] Tests pass
            - [ ] Linting passes
            - [ ] Documentation updated
            - [ ] Conventional commit format
      
      governance:
        id: "ws_governance"
        priority: "P1"
        description: "Add governance and automation"
        
        branch_protection:
          main:
            required_reviews: 1
            dismiss_stale_reviews: true
            require_code_owner_reviews: true
            require_status_checks:
              - "test"
              - "lint"
              - "security"
            require_branches_up_to_date: true
            restrict_pushes: true
            allow_force_pushes: false
            allow_deletions: false
        
        adr_template: |
          # ADR {number}: {title}
          
          ## Status
          {Proposed|Accepted|Deprecated|Superseded}
          
          ## Context
          {What is the issue?}
          
          ## Decision
          {What is the change?}
          
          ## Consequences
          {What becomes easier/harder?}
          
          ## Alternatives Considered
          {What else was considered?}
      
      containerization:
        id: "ws_containers"
        priority: "P2"
        description: "Add containerization best practices"
        
        dockerfile_template: |
          # syntax=docker/dockerfile:1
          
          # Build stage
          FROM {base_image} AS builder
          WORKDIR /app
          COPY {lockfile} .
          RUN {install_command}
          COPY . .
          RUN {build_command}
          
          # Runtime stage
          FROM {runtime_image}
          RUN adduser --disabled-password --gecos "" appuser
          USER appuser
          WORKDIR /app
          COPY --from=builder /app/{artifact} .
          EXPOSE {port}
          HEALTHCHECK --interval=30s --timeout=3s \
            CMD {health_check_command}
          CMD ["{entrypoint}"]
        
        best_practices:
          - "Use multi-stage builds"
          - "Use non-root user"
          - "Use distroless/minimal base images"
          - "Pin dependency versions"
          - "Add health checks"
          - "Minimize layers"
          - "Use .dockerignore"
        
        compose_template: |
          version: '3.8'
          services:
            app:
              build: .
              ports:
                - "{port}:{port}"
              environment:
                - NODE_ENV=production
              healthcheck:
                test: {health_check}
                interval: 30s
                timeout: 10s
                retries: 3
      
      observability:
        id: "ws_observability"
        priority: "P2"
        description: "Add logging, metrics, tracing"
        
        logging:
          format: "JSON structured logging"
          fields:
            - "timestamp"
            - "level"
            - "message"
            - "service"
            - "trace_id"
            - "span_id"
          
          example: |
            {
              "timestamp": "2025-01-18T12:00:00Z",
              "level": "info",
              "message": "Request processed",
              "service": "api",
              "trace_id": "abc123",
              "duration_ms": 42
            }
        
        metrics:
          standard:
            - "request_count"
            - "request_duration_seconds"
            - "error_count"
            - "active_connections"
        
        tracing:
          standard: "OpenTelemetry"
          propagation: "W3C Trace Context"
    
    output_template: |
      # CHANGES
      
      ## Summary
      - **Files Changed**: {files_changed}
      - **Files Created**: {files_created}
      - **Lines Added**: {lines_added}
      - **Lines Removed**: {lines_removed}
      
      ## Changes by Category
      
      ### Bug Fixes
      {bug_fixes}
      
      ### Tests
      {tests}
      
      ### CI/CD
      {ci_cd}
      
      ### Security
      {security}
      
      ### Documentation
      {documentation}
      
      ## Commits
      {commits}
      
      ## Patches
      {patches}

  - id: "phase_4_verification"
    name: "Verification & Reporting"
    agent: "verification_agent"
    timeout_minutes: 15
    
    steps:
      - id: "4.1"
        name: "Test Verification"
        actions:
          - "Run full test suite 3x"
          - "Measure coverage before/after"
          - "Check for flaky tests"
          - "Verify new tests pass"
      
      - id: "4.2"
        name: "Lint Verification"
        actions:
          - "Run linter"
          - "Count violations before/after"
          - "Verify no new violations"
      
      - id: "4.3"
        name: "Security Verification"
        actions:
          - "Run secret scanner"
          - "Run dependency scanner"
          - "Run SAST"
          - "Verify no new findings"
      
      - id: "4.4"
        name: "Build Verification"
        actions:
          - "Run build"
          - "Check for warnings"
          - "Verify artifacts"
      
      - id: "4.5"
        name: "Documentation Verification"
        actions:
          - "Verify all links"
          - "Check code examples"
          - "Test setup instructions"
      
      - id: "4.6"
        name: "Report Generation"
        actions:
          - "Calculate all metrics"
          - "Generate summary"
          - "List followups"
          - "Provide rollback instructions"
          - "Generate PR description"
    
    output_template: |
      # VERIFICATION REPORT
      
      ## Overall Status: {status}
      
      ## Test Results
      | Metric | Before | After | Delta | Target | Status |
      |--------|--------|-------|-------|--------|--------|
      | Coverage | {before}% | {after}% | {delta}% | +5% | {status} |
      | Passing | {before} | {after} | {delta} | 100% | {status} |
      | Flaky | {before} | {after} | {delta} | 0 | {status} |
      
      ## Security Results
      | Scan | Status | Findings |
      |------|--------|----------|
      | Secrets | {status} | {count} |
      | Dependencies | {status} | {count} |
      | SAST | {status} | {count} |
      
      ## Lint Results
      - **Before**: {before} violations
      - **After**: {after} violations
      - **New**: {new} violations
      
      ## Build Results
      - **Status**: {status}
      - **Warnings**: {warnings}
      - **Duration**: {duration}
      
      ---
      
      # FINAL REPORT
      
      ## Executive Summary
      {summary}
      
      ## Changes Made
      {changes_summary}
      
      ## Metrics
      {metrics_table}
      
      ## Assumptions
      {assumptions}
      
      ## Known Limitations
      {limitations}
      
      ## Follow-ups
      {followups}
      
      ## Rollback Procedure
      ```bash
      {rollback_commands}
      ```
      
      ## PR Ready
      - **Title**: {pr_title}
      - **Labels**: {pr_labels}
      - **Description**: {pr_description}

#═══════════════════════════════════════════════════════════════════════════════
# COMMIT PROTOCOL (Conventional Commits)
#═══════════════════════════════════════════════════════════════════════════════

commit_protocol:
  standard: "Conventional Commits 1.0.0"
  format: "<type>(<scope>): <subject>\n\n[body]\n\n[footer]"
  
  types:
    - type: "fix"
      description: "Bug fix"
      semver: "PATCH"
      example: "fix(auth): prevent token leak in logs"
    
    - type: "feat"
      description: "New feature"
      semver: "MINOR"
      example: "feat(api): add user profile endpoint"
    
    - type: "docs"
      description: "Documentation"
      semver: null
      example: "docs: update installation guide"
    
    - type: "style"
      description: "Formatting"
      semver: null
      example: "style: format with prettier"
    
    - type: "refactor"
      description: "Refactoring"
      semver: null
      example: "refactor(parser): simplify logic"
    
    - type: "perf"
      description: "Performance"
      semver: "PATCH"
      example: "perf(db): add index"
    
    - type: "test"
      description: "Tests"
      semver: null
      example: "test: add auth tests"
    
    - type: "build"
      description: "Build system"
      semver: null
      example: "build: update deps"
    
    - type: "ci"
      description: "CI/CD"
      semver: null
      example: "ci: add CodeQL"
    
    - type: "chore"
      description: "Maintenance"
      semver: null
      example: "chore: update gitignore"
    
    - type: "revert"
      description: "Revert"
      semver: null
      example: "revert: revert feat(api)"
  
  breaking_changes:
    indicator: "! after type/scope OR BREAKING CHANGE in footer"
    semver: "MAJOR"
    examples:
      - "feat(api)!: remove v1 endpoint"
      - "fix!: change default port\n\nBREAKING CHANGE: port changed"
  
  rules:
    subject:
      - "Imperative mood (add, not added)"
      - "No capital first letter"
      - "No period at end"
      - "Max 50 characters"
    
    body:
      - "Wrap at 72 characters"
      - "Explain what and why"
      - "Separate from subject with blank line"
    
    footer:
      - "Closes #123"
      - "BREAKING CHANGE: description"
      - "Co-authored-by: Name <email>"
  
  automation:
    changelog: "git-cliff --latest > CHANGELOG.md"
    versioning:
      - "fix → PATCH (1.0.0 → 1.0.1)"
      - "feat → MINOR (1.0.0 → 1.1.0)"
      - "BREAKING CHANGE → MAJOR (1.0.0 → 2.0.0)"

#═══════════════════════════════════════════════════════════════════════════════
# CHANGE MANAGEMENT
#═══════════════════════════════════════════════════════════════════════════════

change_management:
  breaking_changes:
    required:
      - "MIGRATION.md with step-by-step guide"
      - "Deprecation warnings in code"
      - "Major version bump"
      - "PR labeled 'breaking-change'"
      - "Changelog entry"
    
    migration_template: |
      # Migration: v{old} → v{new}
      
      ## Breaking Changes
      
      ### {Change 1}
      **What**: {description}
      **Why**: {rationale}
      
      **Before**:
      ```{lang}
      {old_code}
      ```
      
      **After**:
      ```{lang}
      {new_code}
      ```
  
  rollback:
    principles:
      - "Every change must be revertible"
      - "Document rollback in commit footer"
      - "Test rollback procedure"
    
    procedure:
      code: "git revert {commit_hash}"
      database: "Run down() migration"
      config: "Restore previous version"
    
    documentation: |
      ## Rollback
      
      1. Revert commits:
         ```bash
         git revert {commits}
         ```
      
      2. Additional steps:
         {manual_steps}
      
      3. Verify:
         ```bash
         {verify_commands}
         ```
  
  hotfix:
    process:
      - "Create hotfix branch from main"
      - "Implement minimal fix"
      - "Add regression test"
      - "PR to main (expedited review)"
      - "Cherry-pick to release branches"
      - "Tag patch release"
    
    template: |
      ## Hotfix: {title}
      
      **Severity**: {severity}
      **Affected Versions**: {versions}
      
      ### Issue
      {description}
      
      ### Fix
      {fix_description}
      
      ### Verification
      {verification_steps}

#═══════════════════════════════════════════════════════════════════════════════
# ERROR HANDLING
#═══════════════════════════════════════════════════════════════════════════════

error_handling:
  principles:
    - "Fail safe, not fast"
    - "Prefer partial success over total failure"
    - "Capture errors with context"
    - "Provide actionable next steps"
    - "Degrade gracefully"
  
  strategies:
    tool_unavailable:
      action: "Skip with documentation"
      output: |
        ⚠️ TOOL_UNAVAILABLE: {tool}
        
        Install: `{install_command}`
        Skipping {tool} checks.
    
    execution_failed:
      action: "Generate manual script"
      output: |
        ⚠️ MANUAL_VERIFICATION_REQUIRED
        
        Run manually:
        ```bash
        {commands}
        ```
    
    breaking_change_detected:
      action: "Halt and document"
      output: |
        🛑 BREAKING_CHANGE_DETECTED
        
        Change: {description}
        Impact: {impact}
        
        Required actions:
        1. Create MIGRATION.md
        2. Bump major version
        3. Add deprecation warnings
    
    ambiguous_input:
      action: "Use conservative default"
      output: |
        ℹ️ ASSUMPTION_MADE
        
        Ambiguous: {description}
        Chosen: {decision}
        Rationale: {rationale}
  
  recovery:
    retry:
      deterministic_ops: false
      network_ops: true
      max_attempts: 3
      backoff: "exponential with jitter"
    
    fallback:
      - "Try alternative tool"
      - "Use simpler approach"
      - "Document for manual completion"

#═══════════════════════════════════════════════════════════════════════════════
# MONOREPO SUPPORT
#═══════════════════════════════════════════════════════════════════════════════

monorepo:
  detection:
    indicators:
      - "packages/ or apps/ directory"
      - "Multiple package.json/pyproject.toml files"
      - "Workspace configuration (pnpm-workspace.yaml, etc.)"
      - "Monorepo tool config (nx.json, turbo.json, lerna.json)"
    
    tools:
      nx: "nx.json"
      turborepo: "turbo.json"
      lerna: "lerna.json"
      pnpm: "pnpm-workspace.yaml"
      rush: "rush.json"
      bazel: "WORKSPACE or BUILD files"
  
  strategies:
    discovery:
      - "Identify all packages/apps"
      - "Map dependencies between packages"
      - "Detect shared tooling"
      - "Identify affected packages per change"
    
    execution:
      - "Apply changes per-package when appropriate"
      - "Use path-based CI filtering"
      - "Parallelize independent packages"
      - "Test affected packages only"
    
    ci_optimization:
      path_filtering: |
        on:
          push:
            paths:
              - 'packages/{package}/**'
      
      affected_only: |
        - name: Get affected
          run: npx nx affected:test --base=origin/main
  
  package_schema:
    type: "object"
    properties:
      name: { type: "string" }
      path: { type: "string" }
      type: { type: "string", enum: ["app", "lib", "service", "tool"] }
      language: { type: "string" }
      dependencies: { type: "array", items: { type: "string" } }
      scripts: { type: "object" }

#═══════════════════════════════════════════════════════════════════════════════
# REPO SIZE SCALING
#═══════════════════════════════════════════════════════════════════════════════

scaling:
  tiers:
    tiny:
      criteria:
        files: "< 10"
        loc: "< 1,000"
        contributors: "1"
      
      include:
        - "README.md"
        - "LICENSE"
        - "Basic CI (test)"
        - ".gitignore"
      
      skip:
        - "CONTRIBUTING.md"
        - "SECURITY.md"
        - "CODEOWNERS"
        - "Complex CI"
    
    small:
      criteria:
        files: "10-100"
        loc: "1,000-10,000"
        contributors: "2-5"
      
      include:
        - "Everything from tiny"
        - "CONTRIBUTING.md"
        - "SECURITY.md"
        - "Pre-commit hooks"
        - "CI with lint + test"
      
      skip:
        - "CODEOWNERS"
        - "ADRs"
        - "Advanced CI"
    
    medium:
      criteria:
        files: "100-1,000"
        loc: "10,000-100,000"
        contributors: "5-20"
      
      include:
        - "Everything from small"
        - "CODEOWNERS"
        - "Issue/PR templates"
        - "Branch protection"
        - "Dependabot/Renovate"
        - "SBOM"
        - "Advanced CI"
    
    large:
      criteria:
        files: "> 1,000"
        loc: "> 100,000"
        contributors: "> 20"
      
      include:
        - "Everything from medium"
        - "ADRs"
        - "Full governance"
        - "Chaos engineering"
        - "Performance testing"
        - "Observability stack"

#═══════════════════════════════════════════════════════════════════════════════
# LANGUAGE-SPECIFIC VERIFICATION COMMANDS
#═══════════════════════════════════════════════════════════════════════════════

verification_commands:
  detection:
    commands:
      - "test -f pyproject.toml && echo 'python'"
      - "test -f package.json && echo 'node'"
      - "test -f go.mod && echo 'go'"
      - "test -f Cargo.toml && echo 'rust'"
      - "test -f pom.xml && echo 'java-maven'"
      - "test -f build.gradle && echo 'java-gradle'"
      - "test -f Gemfile && echo 'ruby'"
      - "test -f composer.json && echo 'php'"
      - "test -f *.csproj && echo 'dotnet'"
      - "test -f Package.swift && echo 'swift'"
      - "test -f build.gradle.kts && echo 'kotlin'"
      - "test -f mix.exs && echo 'elixir'"
      - "test -f build.sbt && echo 'scala'"
      - "test -f CMakeLists.txt && echo 'cpp'"
  
  languages:
    python:
      setup:
        - "python -m pip install --upgrade pip"
        - "pip install -e '.[dev]' || pip install -e ."
      test:
        - "pytest -v --cov --cov-report=term --cov-report=xml"
      lint:
        - "ruff check ."
        - "black --check ."
        - "mypy . || true"
      format:
        - "black ."
        - "isort ."
      security:
        - "pip-audit"
        - "bandit -r . || true"
      build:
        - "python -m build"
    
    node:
      setup:
        - "npm ci"
      test:
        - "npm test"
        - "npm run test:coverage || true"
      lint:
        - "npm run lint || npx eslint ."
        - "npx tsc --noEmit || true"
      format:
        - "npm run format || npx prettier --write ."
      security:
        - "npm audit"
      build:
        - "npm run build"
    
    go:
      setup:
        - "go mod download"
      test:
        - "go test ./... -v -cover -coverprofile=coverage.out"
      lint:
        - "gofmt -l ."
        - "go vet ./..."
        - "golangci-lint run || true"
      format:
        - "gofmt -w ."
      security:
        - "govulncheck ./... || true"
      build:
        - "go build ./..."
    
    rust:
      setup:
        - "cargo fetch"
      test:
        - "cargo test --all-features"
      lint:
        - "cargo fmt -- --check"
        - "cargo clippy -- -D warnings"
      format:
        - "cargo fmt"
      security:
        - "cargo audit"
      build:
        - "cargo build --release"
    
    java_maven:
      setup:
        - "mvn clean install -DskipTests"
      test:
        - "mvn test"
        - "mvn jacoco:report || true"
      lint:
        - "mvn checkstyle:check || true"
      security:
        - "mvn dependency-check:check || true"
      build:
        - "mvn package"
    
    java_gradle:
      setup:
        - "./gradlew build -x test"
      test:
        - "./gradlew test"
      lint:
        - "./gradlew checkstyleMain || true"
      security:
        - "./gradlew dependencyCheckAnalyze || true"
      build:
        - "./gradlew build"
    
    ruby:
      setup:
        - "bundle install"
      test:
        - "bundle exec rspec"
      lint:
        - "bundle exec rubocop"
      format:
        - "bundle exec rubocop -a"
      security:
        - "bundle audit check --update"
      build:
        - "bundle exec rake build || true"
    
    php:
      setup:
        - "composer install"
      test:
        - "vendor/bin/phpunit"
      lint:
        - "vendor/bin/phpcs || true"
        - "vendor/bin/phpstan analyse || true"
      format:
        - "vendor/bin/phpcbf || true"
      security:
        - "composer audit"
      build:
        - "composer dump-autoload --optimize"
    
    dotnet:
      setup:
        - "dotnet restore"
      test:
        - "dotnet test --collect:\"XPlat Code Coverage\""
      lint:
        - "dotnet format --verify-no-changes"
      format:
        - "dotnet format"
      security:
        - "dotnet list package --vulnerable"
      build:
        - "dotnet build --configuration Release"
    
    swift:
      setup:
        - "swift package resolve"
      test:
        - "swift test"
      lint:
        - "swiftlint || true"
      format:
        - "swiftformat . || true"
      build:
        - "swift build"
    
    kotlin:
      setup:
        - "./gradlew dependencies"
      test:
        - "./gradlew test"
      lint:
        - "./gradlew ktlintCheck || true"
      format:
        - "./gradlew ktlintFormat"
      build:
        - "./gradlew build"
    
    elixir:
      setup:
        - "mix deps.get"
      test:
        - "mix test"
      lint:
        - "mix credo || true"
        - "mix dialyzer || true"
      format:
        - "mix format"
      security:
        - "mix deps.audit || true"
      build:
        - "mix compile"
    
    scala:
      setup:
        - "sbt update"
      test:
        - "sbt test"
      lint:
        - "sbt scalafmtCheck || true"
      format:
        - "sbt scalafmt"
      build:
        - "sbt compile"
    
    cpp:
      setup:
        - "cmake -B build"
      test:
        - "cmake --build build --target test"
      lint:
        - "clang-tidy src/*.cpp || true"
      format:
        - "clang-format -i src/*.cpp src/*.h"
      build:
        - "cmake --build build"

#═══════════════════════════════════════════════════════════════════════════════
# TROUBLESHOOTING GUIDE
#═══════════════════════════════════════════════════════════════════════════════

troubleshooting:
  common_issues:
    - issue: "Tests fail after changes"
      causes:
        - "Breaking change not identified"
        - "Missing mock/fixture"
        - "Environment difference"
      solutions:
        - "Review test failures for patterns"
        - "Check if tests depend on external state"
        - "Run tests in isolation"
        - "Rollback and retry incrementally"
    
    - issue: "Lint violations after formatting"
      causes:
        - "Conflicting lint/format rules"
        - "Editor settings differ"
      solutions:
        - "Use single formatter"
        - "Add .editorconfig"
        - "Configure linter to match formatter"
    
    - issue: "CI workflow fails"
      causes:
        - "Syntax error in workflow"
        - "Missing permissions"
        - "Unavailable action version"
      solutions:
        - "Validate YAML syntax"
        - "Check action versions"
        - "Review permissions block"
    
    - issue: "Dependency installation fails"
      causes:
        - "Network issues"
        - "Version conflicts"
        - "Platform incompatibility"
      solutions:
        - "Check lockfile integrity"
        - "Try clean install"
        - "Check platform requirements"
    
    - issue: "Monorepo package detection fails"
      causes:
        - "Non-standard structure"
        - "Missing workspace config"
      solutions:
        - "Check for workspace file"
        - "Verify package.json workspaces field"
        - "Manual package enumeration"
  
  debugging_tips:
    - "Enable verbose output for tools"
    - "Run tools in isolation"
    - "Check environment variables"
    - "Compare with known-good state"
    - "Review recent changes in git log"
  
  escalation:
    when_to_escalate:
      - "Security vulnerability discovered"
      - "Data loss risk"
      - "Cannot determine safe rollback"
      - "Breaking change affects external users"
    
    how_to_escalate:
      - "Document issue clearly"
      - "List attempted solutions"
      - "Provide reproduction steps"
      - "Flag for human review"

#═══════════════════════════════════════════════════════════════════════════════
# ADVANCED FEATURES
#═══════════════════════════════════════════════════════════════════════════════

advanced_features:
  mutation_testing:
    description: "Test test quality by introducing bugs"
    tools:
      python: "mutmut"
      javascript: "stryker"
      java: "pitest"
      go: "go-mutesting"
    
    when_to_use:
      - "High-risk code paths"
      - "After significant test additions"
      - "Quality audits"
    
    target_score: "> 80% mutation score"
  
  property_based_testing:
    description: "Generate random test inputs"
    tools:
      python: "hypothesis"
      javascript: "fast-check"
      haskell: "QuickCheck"
      scala: "ScalaCheck"
    
    use_cases:
      - "Parsing/serialization"
      - "Mathematical operations"
      - "State machines"
      - "Protocol implementations"
  
  chaos_engineering:
    description: "Test resilience through controlled failures"
    principles:
      - "Build a hypothesis"
      - "Vary real-world events"
      - "Run in production (safely)"
      - "Automate experiments"
    
    tools:
      - "Chaos Monkey"
      - "LitmusChaos"
      - "Gremlin"
      - "Chaos Mesh"
    
    experiments:
      - "Network latency injection"
      - "Service failure"
      - "Resource exhaustion"
      - "Clock skew"
  
  incident_response:
    playbook_template: |
      # Incident: {title}
      
      ## Severity: {P1|P2|P3|P4}
      
      ## Detection
      - How discovered: {method}
      - Time detected: {timestamp}
      
      ## Impact
      - Affected systems: {systems}
      - Affected users: {user_count}
      
      ## Timeline
      | Time | Action | Owner |
      |------|--------|-------|
      {timeline}
      
      ## Resolution
      {resolution_steps}
      
      ## Post-Mortem
      ### Root Cause
      {root_cause}
      
      ### Contributing Factors
      {factors}
      
      ### Action Items
      - [ ] {action_1}
      - [ ] {action_2}
      
      ### Lessons Learned
      {lessons}
  
  technical_debt:
    tracking:
      - "Tag issues with 'tech-debt'"
      - "Maintain debt backlog"
      - "Schedule debt sprints"
      - "Track debt metrics"
    
    categories:
      - "Code quality"
      - "Test coverage"
      - "Documentation"
      - "Dependencies"
      - "Architecture"
      - "Security"
    
    prioritization:
      formula: "impact × frequency / cost_to_fix"
      criteria:
        - "Blocks new features"
        - "Causes bugs"
        - "Slows development"
        - "Security risk"

#═══════════════════════════════════════════════════════════════════════════════
# NOTES & BEST PRACTICES
#═══════════════════════════════════════════════════════════════════════════════

notes:
  principles:
    - "Prefer additive over destructive changes"
    - "Document everything non-obvious"
    - "Test before and after"
    - "Always have rollback plan"
    - "Match effort to repo size"
  
  anti_patterns:
    - "Over-engineering small repos"
    - "Ignoring existing conventions"
    - "Making unnecessary breaking changes"
    - "Skipping tests for 'simple' changes"
    - "Committing without verification"
  
  success_factors:
    - "Clear understanding of repo purpose"
    - "Respect for existing patterns"
    - "Incremental improvements"
    - "Comprehensive verification"
    - "Clear documentation"
  
  continuous_improvement:
    - "Track success metrics per run"
    - "Collect feedback on failures"
    - "Update protocol based on learnings"
    - "Share knowledge across runs"

#═══════════════════════════════════════════════════════════════════════════════
# END OF PROTOCOL
#═══════════════════════════════════════════════════════════════════════════════
# 
# Version: 2.1.0
# Lines: ~4,000
# Sections: 25+
# Languages: 14
# CI Platforms: 4
# 
# For updates and contributions:
# https://github.com/your-org/rup-protocol (update this once established on-site.)
#
#═══════════════════════════════════════════════════════════════════════════════